(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){let Rin=module.exports={};Rin.invokeLater=function(fn){if(fn)setTimeout(function(){fn()},10)};Rin.typeOf=function(o){if(o instanceof Array)return"array";if(o===null)return"null";return(typeof o).toString().toLowerCase()};Rin.isArrayOrObject=function(o){switch(Rin.typeOf(o)){case"array":case"object":return true}return false};Rin.clone=function(elem){var o;if(Rin.typeOf(elem)=="array"){o=[];for(let i=0;i<elem.length;i++)o.push(Rin.clone(elem[i]))}else if(Rin.typeOf(elem)=="object"){o={};for(let i in elem)o[i]=Rin.clone(elem[i])}else{o=elem}return o};Rin.merge=function(output,...objs){if(Rin.typeOf(output)=="array"){for(let i=0;i<objs.length;i++){let arr=objs[i];if(Rin.typeOf(arr)!="array"){output.push(arr)}else{for(let j=0;j<arr.length;j++){output.push(Rin.clone(arr[j]))}}}}else if(Rin.typeOf(output)=="object"){for(let i=0;i<objs.length;i++){let obj=objs[i];if(Rin.typeOf(obj)!="object")continue;for(let field in obj){if(Rin.isArrayOrObject(obj[field])){if(field in output)Rin.merge(output[field],obj[field]);else output[field]=Rin.clone(obj[field])}else output[field]=obj[field]}}}return output};Rin.override=function(output,...objs){for(let i=0;i<objs.length;i++){for(let j in objs[i]){output[j]=objs[i][j]}}return output};Rin.indexOf=function(container,value){for(let i in container){if(container[i]==value)return i}return null};Rin.escape=function(str){return(str+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};Rin.ensureTypeOf=function(m,o){if(!o||!m||o instanceof m)return o;if(o.isInstanceOf&&m.prototype.className){if(o.isInstanceOf(m.prototype.className))return o}return new m(o)};Rin.serialize=function(o){return JSON.stringify(o)};Rin.deserialize=function(s){return JSON.parse(s)}},{}],2:[function(require,module,exports){let Rin=require("./alpha");module.exports=Class=function(){};Class._class=Class;Class._super={};Class.prototype.className="Class";Class.prototype.__ctor=function(){};Class.prototype.__init=function(){};Class.prototype.isInstanceOf=function(className){className=Rin.typeOf(className)=="string"?className:className.prototype?className.prototype.className:className.constructor.prototype.className;return className in this._super?true:this.className==className};Class.prototype._initSuperRefs=function(){var _super=this.constructor._super;var _newSuper={};for(let i in _super){let o={};let _prot=_super[i].prototype;for(let j in _prot){if(Rin.typeOf(_prot[j])=="function")o[j]=_prot[j].bind(this)}_newSuper[i]=o}this._super=_newSuper};Class.inherit=function(proto){var self=this._class;var _super=self._super;var _class=self._class;if(Rin.typeOf(proto)=="function"){for(let i in proto._class)if(!/^[A-Z]/.test(i))self[i]=proto._class[i];Rin.override(self.prototype,proto._class.prototype);Rin.override(_super,proto._class._super);if(proto._class.prototype.className)_super[proto._class.prototype.className]=proto._class}else{Rin.override(self.prototype,proto)}self._super=_super;self._class=_class;return self};Class.prototype._extend=function(base,protos){var _class=function(...args){this._initSuperRefs();this.__ctor.apply(this,args)};_class._class=_class;_class._super={};Class.inherit.call(_class,base);delete _class.prototype.className;delete _class.prototype.classInit;for(let i=0;i<protos.length;i++)_class.inherit(protos[i]);delete _class._super.Class;if("classInit"in _class.prototype)_class.prototype.classInit();return _class};Class.extend=function(...protos){return this._class.prototype._extend(this,protos)};Class.create=function(proto){return new(this.extend(proto))}},{"./alpha":1}],3:[function(require,module,exports){const Rin=require("./alpha");const Model=require("./model");const Template=require("./template");const Element=module.exports={protos:{},isRoot:false,modelt:Model,model:null,events:null,__ctor:function(){if(this.events)this.bindEvents(this.events);this._list_watch=[];this._list_visible=[];this._list_property=[];this.init();Object.keys(this._super).reverse().forEach(i=>{if("init"in this._super[i])this._super[i].init()});this.collectWatchers()},init:function(){},setModel:function(model){if(!model)return this;if(!(model instanceof this.modelt))model=new this.modelt(model);if(this.model!=null){this.model.removeEventListener("modelChanged",this.onModelPreChanged,this);this.model.removeEventListener("propertyChanging",this.onModelPropertyChanging,this);this.model.removeEventListener("propertyChanged",this.onModelPropertyPreChanged,this);this.model.removeEventListener("propertyRemoved",this.onModelPropertyRemoved,this)}this.model=model;this.model.addEventListener("modelChanged",this.onModelPreChanged,this);this.model.addEventListener("propertyChanging",this.onModelPropertyChanging,this);this.model.addEventListener("propertyChanged",this.onModelPropertyPreChanged,this);this.model.addEventListener("propertyRemoved",this.onModelPropertyRemoved,this);this.onModelPreChanged();return this},getModel:function(){return this.model},getWidth:function(elem){return(elem||this).getBoundingClientRect().width},getHeight:function(elem){return(elem||this).getBoundingClientRect().height},bindEvents:function(events){for(var evtstr in events){let hdl=events[evtstr];if(Rin.typeOf(hdl)=="string")hdl=this[hdl];hdl=hdl.bind(this);var i=evtstr.indexOf(" ");var name=i==-1?evtstr:evtstr.substr(0,i);var selector=i==-1?"":evtstr.substr(i+1);var args=null;var j=name.indexOf("(");if(j!=-1){args=name.substr(j+1,name.length-j-2).split(",");name=name.substr(0,j)}if(selector.substr(0,1)=="@"){if(selector.substr(1)=="this"){this.listen(name,hdl)}else this[selector.substr(1)].addEventListener(name,hdl);continue}if(name.substr(0,1)=="#"){this.listen("propertyChanged."+name.substr(1),hdl);continue}if(args!=null){switch(name){case"keyup":case"keydown":this.listen(name,selector,function(evt,args){if(Rin.indexOf(args,evt.keyCode.toString())!=-1)return hdl(evt,args)});continue}}this.listen(name,selector,hdl)}return this},listen:function(eventName,selector,handler){if(Rin.typeOf(selector)=="function"){handler=selector;selector=null}this.addEventListener(eventName,evt=>{if(selector&&selector!="*"){let elems=this.querySelectorAll(selector);evt.source=evt.target;while(evt.source!==this){let i=Rin.indexOf(elems,evt.source);if(i!==null){handler.call(this,evt,evt.detail);break}else{evt.source=evt.source.parentElement}}}else{handler.call(this,evt,evt.detail)}evt.stopPropagation()})},dispatch:function(eventName,args){this.dispatchEvent(new CustomEvent(eventName,{bubbles:true,detail:args}))},setInnerHTML:function(value){this.innerHTML=value;this.collectWatchers()},collectWatchers:function(){let self=this;let list;list=this.querySelectorAll("[data-watch='true']");for(let i=0;i<list.length;i++){list[i]._template=Template.compile(list[i].innerHTML);list[i].innerHTML="";list[i].removeAttribute("data-watch");this._list_watch.push(list[i])}list=this.querySelectorAll("[data-visible]");for(let i=0;i<list.length;i++){list[i]._visible=Template.compile(list[i].dataset.visible);list[i].removeAttribute("data-visible");this._list_visible.push(list[i])}list=this.querySelectorAll("[data-property]");for(let i=0;i<list.length;i++){list[i].onchange=function(){switch(this.type){case"checkbox":self.getModel().set(this.name,this.checked?"1":"0");break;default:self.getModel().set(this.name,this.value);break}};list[i].name=list[i].dataset.property;list[i].removeAttribute("data-property");this._list_property.push(list[i])}this._list_watch=this._list_watch.filter(i=>i.parentElement!=null);this._list_visible=this._list_visible.filter(i=>i.parentElement!=null);this._list_property=this._list_property.filter(i=>i.parentElement!=null);if(this.model!=null)this.model.update(true)},onCreated:function(){},onConnected:function(){},onDisconnected:function(){},onModelPreChanged:function(evt,args){let data=this.getModel().get();for(let i=0;i<this._list_watch.length;i++){this._list_watch[i].innerHTML=this._list_watch[i]._template(data)}for(let i=0;i<this._list_visible.length;i++){if(this._list_visible[i]._visible(data,"arg"))this._list_visible[i].style.display="block";else this._list_visible[i].style.display="none"}this.onModelChanged(evt,args)},onModelChanged:function(evt,args){},onModelPropertyChanging:function(evt,args){},onModelPropertyPreChanged:function(evt,args){for(let i=0;i<this._list_property.length;i++){if(this._list_property[i].name==args.name){switch(this._list_property[i].type){case"radio":if(this._list_property[i].value!=args.value){this._list_property[i].parentElement.classList.remove("active");continue}this._list_property[i].checked=true;this._list_property[i].parentElement.classList.add("active");break;case"checkbox":if(~~args.value){this._list_property[i].checked=true;this._list_property[i].parentElement.classList.add("active")}else{this._list_property[i].checked=false;this._list_property[i].parentElement.classList.remove("active")}break;default:this._list_property[i].value=args.value;break}if(this._list_property[i].onchange)this._list_property[i].onchange()}}this.onModelPropertyChanged(evt,args)},onModelPropertyChanged:function(evt,args){this.dispatch("propertyChanged."+args.name,args);this.dispatch("propertyChanged",args)},onModelPropertyRemoved:function(evt,args){},register:function(name,...protos){var newElement=class extends HTMLElement{constructor(){super();this.invokeConstructor=true;this._super={};for(let i of Object.entries(this.constructor.prototype._super)){this._super[i[0]]={};for(let j of Object.entries(i[1])){this._super[i[0]][j[0]]=j[1].bind(this)}}this.onCreated()}findRoot(){let elem=this.parentElement;while(elem!=null){if("isRoot"in elem&&elem.isRoot)return elem;elem=elem.parentElement}return null}connectedCallback(){if(this.dataset.ref){let root=this.findRoot();if(root)root[this.dataset.ref]=this}if(this.invokeConstructor){this.invokeConstructor=false;this.__ctor()}this.onConnected()}disconnectedCallback(){if(this.dataset.ref){let root=this.findRoot();if(root)root[this.dataset.ref]=null}this.onDisconnected()}};Rin.override(newElement.prototype,Element);const proto={};const _super={};for(let i=0;i<protos.length;i++){if(!protos[i])continue;if(Rin.typeOf(protos[i])=="string"){const name=protos[i];protos[i]=Element.protos[name];if(!protos[i])continue;_super[name]={};for(let f in protos[i]){if(Rin.typeOf(protos[i][f])!="function")continue;_super[name][f]=protos[i][f]}}if("_super"in protos[i])Rin.override(_super,protos[i]._super);Rin.override(newElement.prototype,protos[i]);Rin.override(proto,protos[i])}newElement.prototype._super=_super;proto._super=_super;customElements.define(name,newElement);Element.protos[name]=proto;return newElement}}},{"./alpha":1,"./model":8,"./template":9}],4:[function(require,module,exports){let Class=require("./class");let Event=require("./event");module.exports=Class.extend({className:"EventDispatcher",listeners:null,__ctor:function(){this.listeners={}},addEventListener:function(eventName,handler,context,data){eventName=eventName.split(":");var name=eventName[eventName.length-1];var ns=eventName.length>1?eventName[0]:null;if(!this.listeners[name])this.listeners[name]=[];this.listeners[name].push({ns:ns,handler:handler,context:context,data:data,silent:0});return this},removeEventListener:function(eventName,handler,context){eventName=eventName.split(":");var name=eventName[eventName.length-1];var ns=eventName.length>1?eventName[0]:null;if(name=="*"){for(var j in this.listeners){var list=this.listeners[j];for(var i=0;i<list.length;i++){var k=true;if(handler)k=k&&list[i].handler===handler;if(context)k=k&&list[i].context===context;if(ns)k=k&&list[i].ns==ns;if(k)list.splice(i--,1)}}}else{if(!this.listeners[name])return this;var list=this.listeners[name];for(var i=0;i<list.length;i++){var k=true;if(handler)k=k&&list[i].handler===handler;if(context)k=k&&list[i].context===context;if(ns)k=k&&list[i].ns==ns;if(k)list.splice(i--,1)}}return this},prepareEvent:function(eventName,eventArgs,cbHandler,cbContext){var list=[];eventName=eventName.split(":");var name=eventName[eventName.length-1];var ns=eventName.length>1?eventName[0]:null;if(this.listeners[name])list=list.concat(this.listeners[name]);if(this.listeners["*"])list=list.concat(this.listeners["*"]);for(var i=0;i<list.length;i++)if(list[i].silent)list.splice(i--,1);if(ns){for(var i=0;i<list.length;i++)if(list[i].ns!=ns)list.splice(i--,1)}return new Event(this,list,name,eventArgs,cbHandler,cbContext)},silence:function(eventName,value){eventName=eventName.split(":");var name=eventName[eventName.length-1];var ns=eventName.length>1?eventName[0]:null;value=value===false?-1:1;if(name=="*"){for(var j in this.listeners){var list=this.listeners[j];for(var i=0;i<list.length;i++){if(ns&&list[i].ns!=ns)continue;list[i].silent+=value}}}else{if(!this.listeners[name])return this;var list=this.listeners[name];for(var i=0;i<list.length;i++){if(ns&&list[i].ns!=ns)continue;list[i].silent+=value}}return this},dispatchEvent:function(eventName,eventArgs,cbHandler,cbContext){return this.prepareEvent(eventName,eventArgs,cbHandler,cbContext).resume()}})},{"./class":2,"./event":5}],5:[function(require,module,exports){let Rin=require("./alpha");let Class=require("./class");module.exports=Class.extend({className:"Event",source:null,name:null,args:null,_async:false,list:null,next:null,ret:null,original:null,i:-1,__ctor:function(source,list,eventName,eventArgs,cbHandler,cbContext){this.source=source;this.name=eventName;this.args=eventArgs;this.cbHandler=cbHandler;this.cbContext=cbContext;this.list=list;this.reset()},reset:function(){this.next=null;this.ret=[];this._async=false;this.i=-1;return this},wait:function(){this._async=true;return this},resume:function(){this._async=false;while(!this._async){if(++this.i>=this.list.length)break;if(this.list[this.i].silent)continue;if(Rin.typeOf(this.list[this.i].handler)=="string"){if(this.list[this.i].context){if(!this.list[this.i].context[this.list[this.i].handler])continue;if(this.list[this.i].context[this.list[this.i].handler](this,this.args,this.list[this.i].data)===false)break}else{if(window[this.list[this.i].handler].call(null,this,this.args,this.list[this.i].data)===false)break}}else{if(this.list[this.i].handler.call(this.list[this.i].context,this,this.args,this.list[this.i].data)===false)break}}if(this._async)return this;if(this.i>=this.list.length&&this.next)this.next.resume();if(this.cbHandler)this.cbHandler.call(this.cbContext);return this},from:function(event){this.original=event;return this},enqueue:function(event){if(!event)return this;var evt;for(evt=this;evt.next!=null;evt=evt.next);evt.next=event;event.from(this);return this}})},{"./alpha":1,"./class":2}],6:[function(require,module,exports){let Rin=require("./alpha");let Regex=require("./model-regex");module.exports={_getref:function(value,obj){if(typeof value=="string"){if(value.substr(0,1)=="#")value=obj.get(value.substr(1));else if(value.substr(0,1)=="@")value=obj[value.substr(1)];if(typeof value=="string")return eval(value);return value}else return value},type:function(model,ctval,name,value){switch(ctval){case"int":value=parseInt(value);if(isNaN(value))throw new Error(ctval);break;case"float":value=parseFloat(value);if(isNaN(value))throw new Error(ctval);break;case"string":value=value===null||value===undefined?"":value.toString();break;case"bit":if(value===true||value===false){value=value?1:0;break}value=parseInt(value);if(isNaN(value))throw new Error(ctval);value=value?1:0;break;case"array":if(Rin.typeOf(value)=="array")break;if(value===null||value===undefined){value=[];break}throw new Error(ctval);break;case"bool":if(value==="true"||value===true){value=true;break}if(value==="false"||value===false){value=false;break}throw new Error(ctval);break}return value},model:function(model,ctval,name,value){var mclass=this._getref(ctval,model);if(!mclass)throw new Error(ctval);if(!value)return new mclass;return mclass.ensure(value)},cls:function(model,ctval,name,value){var mclass=this._getref(ctval,model);if(!value)return new mclass;return Rin.ensureTypeOf(mclass,value)},arrayof:function(model,ctval,name,value){var mclass=this._getref(ctval,model);if(!value)value=[];if(!mclass||Rin.typeOf(value)!="array")throw new Error(ctval);for(var i=0;i<value.length;i++)value[i]=Rin.ensureTypeOf(mclass,value[i]);return value},arraynull:function(model,ctval,name,value){var remove=false;if(Rin.typeOf(ctval)=="object"){if(ctval.remove)remove=ctval.remove;ctval=ctval.value}if(ctval)return value;if(Rin.typeOf(value)!="array")throw new Error(ctval);for(var i=0;i<value.length;i++){if(value[i]==null){if(remove)value.splice(i--,1);else throw new Error(ctval)}}return value},arraycompliant:function(model,ctval,name,value){var remove=false;if(Rin.typeOf(ctval)=="object"){if(ctval.remove)remove=ctval.remove;ctval=ctval.value}if(!ctval)return value;if(Rin.typeOf(value)!="array")throw new Error(ctval);for(var i=0;i<value.length;i++){if(value[i]==null)continue;if(!value[i].isCompliant()){if(remove)value.splice(i--,1);else throw new Error(ctval)}}return value},required:function(model,ctval,name,value){if(value===null||value===undefined)throw new Error(ctval?"":"null");switch(Rin.typeOf(value)){case"array":if(value.length==0)throw new Error(ctval?"":"null");break;default:if(value.toString().length==0)throw new Error(ctval?"":"null");break}return value},minlen:function(model,ctval,name,value){if(value.toString().length<ctval)throw new Error(ctval);return value},maxlen:function(model,ctval,name,value){if(value.toString().length>ctval)throw new Error(ctval);return value},minval:function(model,ctval,name,value){if(parseFloat(value)<ctval)throw new Error(ctval);return value},maxval:function(model,ctval,name,value){if(parseFloat(value)>ctval)throw new Error(ctval);return value},mincount:function(model,ctval,name,value){if(Rin.typeOf(value)!="array"||value.length<ctval)throw new Error(ctval);return value},maxcount:function(model,ctval,name,value){if(Rin.typeOf(value)!="array"||value.length>ctval)throw new Error(ctval);return value},pattern:function(model,ctval,name,value){if(!Regex[ctval].test(value.toString()))throw new Error(ctval);return value},inset:function(model,ctval,name,value){if(Rin.typeOf(ctval)!="array"){if(!new RegExp("^("+ctval.toString()+")$").test(value.toString()))throw new Error(ctval);return value}if(ctval.indexOf(value.toString())==-1)throw new Error(ctval.join("|"));return value},upper:function(model,ctval,name,value){return ctval?value.toString().toUpperCase():value},lower:function(model,ctval,name,value){return ctval?value.toString().toLowerCase():value}}},{"./alpha":1,"./model-regex":7}],7:[function(require,module,exports){module.exports={email:/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)+$/i,url:/^[\w-]+:\/\/[\w-]+(\.\w+)+.*$/,urlNoProt:/^[\w-]+(\.\w+)+.*$/,name:/^[-A-Za-z0-9_.]+$/,uname:/^['\pL\pN ]+$/,text:/^[^&<>{}]*$/,utext:/^([\r\n\pL\pN\pS &!@#$%*\[\]()_+=;',.\/?:"~-]+)$/}},{}],8:[function(require,module,exports){let Rin=require("./alpha");let EventDispatcher=require("./event-dispatcher");let _Model=module.exports=EventDispatcher.extend({className:"Model",defaults:null,constraints:null,properties:null,changedList:null,_silent:0,_level:0,__ctor:function(){this._super.EventDispatcher.__ctor();this.properties={};if(arguments.length>=2&&arguments[1]!=null){this.reset(arguments[1])}else{var o=null;if(!this.defaults&&this.constraints){var o={};for(var i in this.constraints){var j=this.constraints[i];if(j.def===null||j.def===undefined){o[i]=null;continue}if(typeof j.def=="function")o[i]=j.def();else o[i]=j.def}}this.reset(o)}this.init();if(arguments.length>=1&&arguments[0]!=null)this.set(arguments[0],true);if(this.constraints)this.update();this.ready()},reset:function(defaults,nsilent){if(!this.defaults){if(!defaults||Rin.typeOf(defaults)!="object")return this;this.defaults=defaults}if(Rin.typeOf(this.defaults)=="function")this.properties=this.defaults();else this.properties=Rin.clone(this.defaults);return nsilent===false||defaults===false?this:this.update(null,true)},init:function(){},ready:function(){},silent:function(value){this._silent+=value?1:-1;return this},_validate:function(name,value){if(!this.constraints||!this.constraints[name])return value;var constraints=this.constraints[name];var nvalue=value;for(var ctname in constraints){if(!_Model.Constraints[ctname])continue;try{nvalue=_Model.Constraints[ctname](this,constraints[ctname],name,nvalue)}catch(e){if(e.message=="null")break;throw new Error(`Constraint [${ctname}:${constraints[ctname]}] failed on property '${name}'.`)}}return nvalue},_set:function(name,value){if(!this.constraints||!this.constraints[name]){this.properties[name]=value;return value}var constraints=this.constraints[name];var cvalue=this.properties[name];var nvalue=value;for(var ctname in constraints){if(!_Model.Constraints[ctname])continue;try{nvalue=_Model.Constraints[ctname](this,constraints[ctname],name,nvalue)}catch(e){if(e.message=="null")break;if(!this._silent)this.dispatchEvent("constraintError",{constraint:ctname,message:e.message,name:name,value:value});break}}return this.properties[name]=nvalue},_propertyEvent:function(name,prev,value,direct){var temp={name:name,old:prev,value:value,level:this._level};var evt=this.dispatchEvent("propertyChanging",temp);if(!direct)temp.value=this._set(name,temp.value);else this.properties[name]=temp.value;if(evt!=null&&evt.ret.length&&evt.ret[0]===false)return;this.dispatchEvent("propertyChanged."+name,temp);this.dispatchEvent("propertyChanged",temp);this.changedList.push(name)},set:function(){var n=arguments.length;var force=false,silent=false;if((n>2||n==2&&Rin.typeOf(arguments[0])=="object")&&Rin.typeOf(arguments[n-1])=="boolean"){force=arguments[--n];if(force===false)silent=true}if(this._level==0){this.changedList=[]}this._level++;if(n==2){if(this.properties[arguments[0]]!=arguments[1]||force){if(!this._silent&&!silent)this._propertyEvent(arguments[0],this.properties[arguments[0]],this._validate(arguments[0],arguments[1]));else this._set(arguments[0],arguments[1])}}else{for(var i in arguments[0]){if(this.properties[i]!=arguments[0][i]||force){if(!this._silent&&!silent)this._propertyEvent(i,this.properties[i],this._validate(i,arguments[0][i]));else this._set(i,arguments[0][i])}}}if(!--this._level&&this.changedList.length&&!silent&&!this._silent)this.dispatchEvent("modelChanged",{fields:this.changedList});return this},get:function(name,def){if(arguments.length==0||name===false)return this.properties;if(arguments.length==1&&name===true)return this.flatten();if(arguments.length==2)return this.properties[name]===undefined?def:this.properties[name];return this.properties[name]},getInt:function(name,def){if(arguments.length==2)return this.properties[name]===undefined?def:parseInt(this.properties[name]);return parseInt(this.properties[name])},getFloat:function(name,def){if(arguments.length==2)return this.properties[name]===undefined?def:parseFloat(this.properties[name]);return parseFloat(this.properties[name])},getBool:function(name,def){if(arguments.length==2)name=this.properties[name]===undefined?def:this.properties[name];else name=this.properties[name];if(name==="true"||name===true)return true;if(name==="false"||name===false)return false;return parseInt(name)?true:false},getReference:function(name){var m=this;return{get:function(){return m.get(name)},set:function(value){m.set(name,value)}}},constraint:function(field,constraint,value){if(arguments.length==3||arguments.length==2||arguments.length==1&&Rin.typeOf(field)=="object"){if(this.constraints===this.constructor.prototype.constraints)this.constraints=Rin.clone(this.constraints);switch(arguments.length){case 1:Rin.override(this.constraints,field);break;case 2:Rin.override(this.constraints[field],constraint);break;case 3:this.constraints[field][constraint]=value;break}return this}return!field?this:this.constraints[field]},flatten:function(safe,rsafe){if(safe){var data=this.flatten(false,true);if(data==null)return null;data["class"]=this.classPath;return data}if(!this.constraints&&!this.defaults)return this.properties;if(!this.isCompliant())return{};var constraints=this.constraints;var keys=this.defaults?Rin.typeOf(this.defaults)=="function"?this.defaults():this.defaults:this.constraints;var data={};for(var i in this.properties){if(!(i in keys))continue;if(constraints&&constraints[i]){var ct=constraints[i];if(ct.model){data[i]=this.properties[i]?this.properties[i].flatten(rsafe):null;continue}if(ct.arrayof){data[i]=[];for(var j=0;j<this.properties[i].length;j++)data[i][j]=this.properties[i][j]?this.properties[i][j].flatten(rsafe):null;continue}if(ct.cls){data[i]=this.properties[i]?this.properties[i].flatten():null;continue}}data[i]=this.properties[i]}return data},remove:function(name,nsilent){if(Rin.typeOf(name)=="array"){for(var i=0;i<name.length;i++)delete this.properties[name[i]];if(nsilent!==false&&!this._silent)this.dispatchEvent("propertyRemoved",{fields:name})}else{delete this.properties[name];if(nsilent!==false&&!this._silent)this.dispatchEvent("propertyRemoved",{fields:[name]})}},update:function(fields,direct){if(this._silent)return this;if(this._level==0){this.changedList=[]}this._level++;if(fields&&Rin.typeOf(fields)=="string"){this._propertyEvent(fields,this.properties[fields],this.properties[fields],direct)}else{for(var i in this.properties){if(fields&&Rin.indexOf(fields,i)==-1)continue;this._propertyEvent(i,this.properties[i],this.properties[i],direct)}}if(!--this._level&&this.changedList.length&&!this._silent)this.dispatchEvent("modelChanged",{fields:this.changedList});return this},validate:function(fields){if(!this.constraints)return this;if(fields&&Rin.typeOf(fields)=="string"){this._set(fields,this.properties[fields])}else{for(var i in this.properties){if(fields&&Rin.indexOf(fields,i)==-1)continue;this._set(i,this.properties[i])}}return this},isCompliant:function(){if(!this.constraints)return true;try{for(var i in this.properties)this._validate(i,this.properties[i]);return true}catch(e){}return false},observe:function(property,handler,context){this.addEventListener("propertyChanged."+property,handler,context)},unobserve:function(property,handler,context){this.removeEventListener("propertyChanged."+property,handler,context)},toString:function(){return Rin.serialize(this.get(true))}});_Model.Constraints=require("./model-constraints")},{"./alpha":1,"./event-dispatcher":4,"./model-constraints":6}],9:[function(require,module,exports){let Template=module.exports={parseTemplate:function(template,sym_open,sym_close,is_tpl){let nflush="str",flush=null,state=0,count=0;let str="",nstr="";let parts=[],mparts=parts,nparts=false;if(is_tpl===true){template=template.trim();state=2;mparts.push(parts=[])}template+="\0";for(let i=0;i<template.length;i++){switch(state){case 0:if(template[i]=="\0"){flush="str"}else if(template[i]==sym_open&&template[i+1]=="<"){state=count=1;flush="str";nflush="merge-str"}else if(template[i]==sym_open&&template[i+1]=="@"){state=count=1;flush="str";nflush="merge-str";i++}else if(template[i]==sym_open){state=count=1;flush="str";nflush="tpl"}else{str+=template[i]}break;case 1:if(template[i]=="\0"){throw new Error("Parse error")}if(template[i]==sym_close){count--;if(count<0)throw new Error("Parse error");if(count==0){state=0;flush=nflush;break}}else if(template[i]==sym_open){count++}str+=template[i];break;case 2:if(template[i]=="\0"){flush=nflush;break}else if(template[i]=="."){flush=nflush;nflush="str";break}else if(template[i].match(/[\t\n\r\f\v ]/)!=null){flush=nflush;nflush="str";nparts=true;while(template[i].match(/[\t\n\r\f\v ]/)!=null)i++;i--;break}else if(template[i]==sym_open&&template[i+1]=="<"){if(str)flush=nflush;state=3;count=1;nflush="merge-str";break}else if(template[i]==sym_open&&template[i+1]=="@"){if(str)flush=nflush;state=3;count=1;nflush="merge-str";i++;break}else if(template[i]==sym_open){if(str){flush=nflush;nstr=template[i]}state=3;count=1;nflush="tpl2";if(str)break}str+=template[i];break;case 3:if(template[i]=="\0")throw new Error("Parse error");if(template[i]==sym_close){count--;if(count<0)throw new Error("Parse error");if(count==0){state=2;if(nflush=="merge-str")break}}else if(template[i]==sym_open){count++}str+=template[i];break}if(flush!=null){if(flush=="tpl"){str=Template.parseTemplate(str,sym_open,sym_close,true)}else if(flush=="tpl2"){str=Template.parseTemplate(str,sym_open,sym_close,false);str=str[0]}else if(flush=="merge-str"){str=Template.parseTemplate(str,sym_open,sym_close,false)}if(typeof str!="string"||str.length!=0){if(flush=="merge-str"){for(let i=0;i<str.length;i++)parts.push(str[i])}else parts.push(str)}if(nparts){mparts.push(parts=[]);nparts=false}flush=null;str=nstr;nstr=""}}return mparts},parse:function(template){return this.parseTemplate(template.trim(),"[","]",false)},expand:function(parts,data,mode){if(mode=="var"){parts=Template.expand(parts,data,"obj");if(parts[0]=="nl")return"\n";let escape=true;let quote=false;while(true){if(parts[0][0]=="$"){parts[0]=parts[0].substr(1);quote=true}else if(parts[0][0]=="!"){parts[0]=parts[0].substr(1);escape=false}else break}let i=0;if(parts[i]=="this")i++;for(;i<parts.length&&data!=null;i++){if(parts[i]in data)data=data[parts[i]];else data=null}if(typeof data=="string"){if(escape)data=data.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(quote)data='"'+data+'"'}return data}if(mode=="fn"){var args=[];args.push(Template.expand(parts[0],data,"arg"));if("_"+args[0]in Template.filters)args[0]="_"+args[0];if(!(args[0]in Template.filters))return`(Unknown: ${args[0]})`;if(args[0][0]=="_")return Template.filters[args[0]](parts,data);for(let i=1;i<parts.length;i++)args.push(Template.expand(parts[i],data,"arg"));return Template.filters[args[0]](args,parts,data)}if(mode=="tpl"){if(parts.length==1)return Template.expand(parts[0],data,"var");return Template.expand(parts,data,"fn")}let s=[];for(let i=0;i<parts.length;i++){if(typeof parts[i]!="string")s.push(Template.expand(parts[i],data,"tpl"));else s.push(parts[i])}if(mode=="arg"){if(s.length!=1)return s.join("");return s[0]}if(mode!="obj"){let f=e=>e!=null&&typeof e=="object"?"map"in e?e.map(f).join(""):"join"in e?e.join(""):e.toString():e;s=s.map(f).join("")}return s},compile:function(template){template=Template.parse(template);return function(data,mode){return Template.expand(template,data,mode)}}};Template.filters={not:function(args){return!args[1]},int:function(args){return~~args[1]},eq:function(args){return args[1]==args[2]},ne:function(args){return args[1]!=args[2]},lt:function(args){return args[1]<args[2]},le:function(args){return args[1]<=args[2]},gt:function(args){return args[1]>args[2]},ge:function(args){return args[1]>=args[2]},and:function(args){for(let i=1;i<args.length;i++)if(!args[i])return false;return true},or:function(args){for(let i=1;i<args.length;i++)if(~~args[i])return true;return false},json:function(args){return JSON.stringify(args[1],null,4)},set:function(args,parts,data){data[args[1]]=args[2];return""},trim:function(args){return args[1]?typeof args[1]=="object"?args[1].map(e=>e.trim()):args[1].trim():""},upper:function(args){return args[1]?typeof args[1]=="object"?args[1].map(e=>e.toUpperCase()):args[1].toUpperCase():""},lower:function(args){return args[1]?typeof args[1]=="object"?args[1].map(e=>e.toLowerCase()):args[1].toLowerCase():""},nl2br:function(args){return args[1]?typeof args[1]=="object"?args[1].map(e=>e.replace(/\n/g,"<br/>")):args[1].replace(/\n/g,"<br/>"):""},"%":function(args){args.shift();var name=args.shift();let s="";for(let i=0;i<args.length;i++){if(typeof args[i]!="string"){for(let j=0;j<args[i].length;j++)s+=`<${name}>${args[i][j]}</${name}>`}else s+=`<${name}>${args[i]}</${name}>`}return s},join:function(args){if(args[2]&&typeof args[2]=="object"&&"join"in args[2])return args[2].join(args[1]);return""},split:function(args){if(args[2]&&typeof args[2]=="string")return args[2].split(args[1]);return[]},keys:function(args){if(args[1]&&typeof args[1]=="object")return Object.keys(args[1]);return[]},values:function(args){if(args[1]&&typeof args[1]=="object")return Object.values(args[1]);return[]},each:function(args,parts,data){let var_name="i";let list=args[1];let k=2;if(args[k]&&args[k].match(/^[A-Za-z0-9_-]+$/)!=null)var_name=args[k++];let s=[];for(let i in list){data[var_name]=list[i];data[var_name+"#"]=i;for(let j=k;j<parts.length;j++)s.push(Template.expand(parts[j],data,"obj"))}delete data[var_name];delete data[var_name+"#"];return s},_if:function(parts,data){for(let i=0;i<parts.length;i+=3){if(Template.expand(parts[i],data,"arg")=="else")return Template.expand(parts[i+1],data,"arg");if(Template.expand(parts[i+1],data,"arg"))return Template.expand(parts[i+2],data,"arg")}return""},_switch:function(parts,data){let value=Template.expand(parts[1],data,"arg");for(let i=2;i<parts.length;i+=2){let case_value=Template.expand(parts[i],data,"arg");if(case_value==value||case_value=="default")return Template.expand(parts[i+1],data,"arg")}return""}}},{}],10:[function(require,module,exports){const xui=require("../xui");xui.register("xui-dialog",{isRoot:true,events:{"click [data-action]":function(evt){this[evt.source.dataset.action]()}},init:function(){this.classList.add("xui-dialog");if(this.classList.contains("x-draggable"))xui.draggable.attach(this.querySelector(".header"),this)},hide:function(){this.classList.remove("visible");this.classList.add("hidden")},show:function(){this.classList.remove("hidden");this.classList.add("visible")}})},{"../xui":13}],11:[function(require,module,exports){const xui=require("../xui");xui.register("xui-list",{events:{"click span[data-value]":function(evt){this.setValue(evt.source.dataset.value)}},init:function(){this.classList.add("xui-list");if(this.dataset.rows){this.style.height="0px";this.style.height=this.dataset.rows*this.getHeight(this.children[0])+this.getHeight()+"px"}},setValue:function(value){let selected=this.querySelector('span[data-value="'+value+'"]');if(!selected)return false;this.querySelectorAll("span.selected").forEach(i=>i.classList.remove("selected"));selected.classList.add("selected");return true},getValue:function(value){let selected=this.querySelector("span.selected");return selected?selected.dataset.value:null}})},{"../xui":13}],12:[function(require,module,exports){require("./elems/dialog.js");require("./elems/list.js");module.exports=require("./xui")},{"./elems/dialog.js":10,"./elems/list.js":11,"./xui":13}],13:[function(require,module,exports){const Element=require("@rsthn/rin/element");const Template=require("@rsthn/rin/template");const xui=module.exports={elements:[],template:function(str){return Template.compile(str)},register:function(name,...protos){this.elements.push(name);Element.register(name,...protos)},alignValue:function(value,step){return Math.round(value/step)*step},position:{get:function(elem){let p=elem.getBoundingClientRect();return{x:p.left,y:p.top}},set:function(elem,...args){if(args.length==1)return this.set(elem,args[0].x,args[0].y);elem.style.position="absolute";elem.style.margin=0;elem.style.left=args[0]+"px";elem.style.top=args[1]+"px"}},draggable:{initialized:false,state:{enabled:false,sx:0,sy:0,pos:null,target:null},attach:function(handle,target,options){if(!handle||!target)return;if(!this.initialized){if("ontouchstart"in window){window.ontouchmove=(evt=>{document.getElementById("x").innerHTML="MOVE";evt=evt.changedTouches[0];this._handler(evt)})}else window.onmousemove=this._handler.bind(this);this.initialized=true}if("ontouchstart"in window){handle.ontouchstart=(evt=>{document.getElementById("x").innerHTML="START";evt=evt.changedTouches[0];this.state.sx=evt.clientX;this.state.sy=evt.clientY;this.state.pos=xui.position.get(this.state.target=target);this.state.enabled=true});handle.ontouchend=(evt=>{document.getElementById("x").innerHTML="END";this.state.enabled=false})}else{handle.onmousedown=(evt=>{this.state.sx=evt.clientX;this.state.sy=evt.clientY;this.state.pos=xui.position.get(this.state.target=target);this.state.enabled=true});handle.onmouseup=(evt=>{this.state.enabled=false})}},_handler:function(evt){if(!this.state.enabled)return;let dx=evt.clientX-this.state.sx;let dy=evt.clientY-this.state.sy;xui.position.set(this.state.target,this.state.pos.x+dx,this.state.pos.y+dy)}}}},{"@rsthn/rin/element":3,"@rsthn/rin/template":9}]},{},[12]);
