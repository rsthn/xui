(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){const base64=require("base-64");if(!("fetch"in globalThis))var fetch=require("node-fetch");module.exports={apiUrl:"/api",useReq64:false,retries:1,_requestLevel:0,_requestPackage:0,_packageData:[],responseFilter:function(res,req){if(res.response==408&&globalThis.location){globalThis.location.reload();return false}return true},packageBegin:function(){this._requestPackage++},packageEnd:function(){if(!this._requestPackage)return;if(--this._requestPackage)return;this.packageSend()},packageSend:function(){if(!this._packageData.length)return;let _packageData=this._packageData;this._packageData=[];var rpkg="";for(var i=0;i<_packageData.length;i++){rpkg+="r"+i+","+base64.encode(this.encodeParams(_packageData[i][2]))+";"}this._showProgress();this.post({rpkg:rpkg},(res,req)=>{for(let i=0;i<_packageData.length;i++){try{var response=res["r"+i];if(!response){if(_packageData[i][1]!=null)_packageData[i][1](_packageData[i][2]);continue}if(_packageData[i][0]!=null){if(this.responseFilter(response,_packageData[i][2])){_packageData[i][0](response,_packageData[i][2])}}}catch(e){}}},req=>{for(let i=0;i<_packageData.length;i++){if(_packageData[i][1]!=null)_packageData[i][1](_packageData[i][2])}})},_showProgress:function(){if("document"in globalThis){this._requestLevel++;if(this._requestLevel>0)globalThis.document.documentElement.classList.add("busy")}},_hideProgress:function(){if("document"in globalThis){this._requestLevel--;if(!this._requestLevel)globalThis.document.documentElement.classList.remove("busy")}},encodeParams:function(obj){let s=[];for(let i in obj)s.push(encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return s.join("&")},apiCall:function(params,success,failure,type,retries){let url=this.apiUrl;if(type!="GET"&&type!="POST")type="auto";if(this._requestPackage){this._packageData.push([success,failure,params]);return}this._showProgress();let request=params;params=this.encodeParams(params);if(type=="auto"&&!this.useReq64){type=params.length<960?"GET":type}if(retries===undefined)retries=this.retries;if(type=="auto")type="POST";if(this.useReq64)params="_req64="+base64.encode(params);(type=="GET"?fetch(url+"?_="+Date.now()+"&"+params):fetch(url,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",body:params})).then(result=>result.json()).then(result=>{this._hideProgress();if(!success)return;if(this.responseFilter(result,request))success(result,request)}).catch(err=>{this._hideProgress();if(retries==0){if(failure)failure(request)}else{this.apiCall(request,success,failure,type,retries-1)}})},post:function(params,success,failure){return this.apiCall(params,success,failure,"POST")},get:function(params,success,failure){return this.apiCall(params,success,failure,"GET")},fetch:function(params){return new Promise((resolve,reject)=>{this.apiCall(params,resolve,reject)})}}},{"base-64":4,"node-fetch":5}],2:[function(require,module,exports){const{Rin:Rin,Model:Model,Template:Template}=require("@rsthn/rin");const Element=module.exports={protos:{},isRoot:false,modelt:Model,model:null,events:null,__ctor:function(){if(this.events)this.bindEvents(this.events);this._list_watch=[];this._list_visible=[];this._list_property=[];if(this.model!=null){let tmp=this.model;this.model=null;this.setModel(tmp)}this.init();Object.keys(this._super).reverse().forEach(i=>{if("init"in this._super[i])this._super[i].init()});this.collectWatchers()},init:function(){},setModel:function(model,update){if(!model)return this;model=Rin.ensureTypeOf(this.modelt,model);if(this.model!=null){this.model.removeEventListener("modelChanged",this.onModelPreChanged,this);this.model.removeEventListener("propertyChanging",this.onModelPropertyChanging,this);this.model.removeEventListener("propertyChanged",this.onModelPropertyPreChanged,this);this.model.removeEventListener("propertyRemoved",this.onModelPropertyRemoved,this)}this.model=model;this.model.addEventListener("modelChanged",this.onModelPreChanged,this);this.model.addEventListener("propertyChanging",this.onModelPropertyChanging,this);this.model.addEventListener("propertyChanged",this.onModelPropertyPreChanged,this);this.model.addEventListener("propertyRemoved",this.onModelPropertyRemoved,this);if(update!==false)this.model.update();return this},getModel:function(){return this.model},getWidth:function(elem){return(elem||this).getBoundingClientRect().width},getHeight:function(elem){return(elem||this).getBoundingClientRect().height},bindEvents:function(events){for(var evtstr in events){let hdl=events[evtstr];if(Rin.typeOf(hdl)=="string")hdl=this[hdl];hdl=hdl.bind(this);var i=evtstr.indexOf(" ");var name=i==-1?evtstr:evtstr.substr(0,i);var selector=i==-1?"":evtstr.substr(i+1);var args=null;var j=name.indexOf("(");if(j!=-1){args=name.substr(j+1,name.length-j-2).split(",");name=name.substr(0,j)}if(selector.substr(0,1)=="@"){if(selector.substr(1)=="this"){this.listen(name,hdl)}else this[selector.substr(1)].addEventListener(name,hdl);continue}if(name.substr(0,1)=="#"){this.listen("propertyChanged."+name.substr(1),hdl);continue}if(args!=null){switch(name){case"keyup":case"keydown":this.listen(name,selector,function(evt){if(Rin.indexOf(args,evt.keyCode.toString())!=-1)return hdl(evt,args)});continue}}this.listen(name,selector,hdl)}return this},listen:function(eventName,selector,handler){if(Rin.typeOf(selector)=="function"){handler=selector;selector=null}let callback=null;let self=this;this.addEventListener(eventName,callback=(evt=>{if(evt.handled===true)return;evt.handled=false;evt.continuePropagation=true;if(selector&&selector!="*"){let elems=this.querySelectorAll(selector);evt.source=evt.target;while(evt.source!==this){let i=Rin.indexOf(elems,evt.source);if(i!==-1){evt.handled=true;evt.continuePropagation=/^(click)$/.test(eventName)?true:false;handler.call(this,evt,evt.detail);break}else{evt.source=evt.source.parentElement}}}else{evt.handled=true;evt.continuePropagation=/^(click)$/.test(eventName)?true:false;handler.call(this,evt,evt.detail)}evt.preventDefault();if(!evt.continuePropagation)evt.stopPropagation()}));return{removed:false,remove:function(){if(this.removed)return;this.removed=true;self.removeEventListener(eventName,callback)}}},dispatch:function(eventName,args){this.dispatchEvent(new CustomEvent(eventName,{bubbles:true,detail:args}))},setInnerHTML:function(value){this.innerHTML=value;this.collectWatchers()},collectWatchers:function(){let self=this;let modified=false;let list;let _list_watch_length=this._list_watch.length;let _list_visible_length=this._list_visible.length;let _list_property_length=this._list_property.length;list=this.querySelectorAll("[data-watch]");for(let i=0;i<list.length;i++){for(let j of list[i].querySelectorAll(".pseudo"))j.remove();list[i]._template=Template.compile(list[i].innerHTML);list[i]._watch=new RegExp(list[i].dataset.watch);list[i].innerHTML="";list[i].removeAttribute("data-watch");this._list_watch.push(list[i])}list=this.querySelectorAll("[data-visible]");for(let i=0;i<list.length;i++){list[i]._visible=Template.compile(list[i].dataset.visible);list[i].removeAttribute("data-visible");this._list_visible.push(list[i])}list=this.querySelectorAll("[data-property]");for(let i=0;i<list.length;i++){list[i].onchange=function(){switch(this.type){case"checkbox":self.getModel().set(this.name,this.checked?"1":"0");break;case"field":self.getModel().set(this.name,this.getValue());break;default:self.getModel().set(this.name,this.value);break}};list[i].name=list[i].dataset.property;list[i].removeAttribute("data-property");this._list_property.push(list[i])}this._list_watch=this._list_watch.filter(i=>i.parentElement!=null);if(_list_watch_length!=this._list_watch.length)modified=true;this._list_visible=this._list_visible.filter(i=>i.parentElement!=null);if(_list_visible_length!=this._list_visible.length)modified=true;this._list_property=this._list_property.filter(i=>i.parentElement!=null);if(_list_property_length!=this._list_property.length)modified=true;if(this.model!=null&&modified)this.model.update()},onCreated:function(){},onConnected:function(){},onDisconnected:function(){},onRefAdded:function(name){},onRefRemoved:function(name){},onModelPreChanged:function(evt,args){let data=this.getModel().get();for(let i=0;i<this._list_watch.length;i++){for(let j of args.fields){if(!this._list_watch[i]._watch.test(j))continue;this._list_watch[i].innerHTML=this._list_watch[i]._template(data);break}}for(let i=0;i<this._list_visible.length;i++){if(this._list_visible[i]._visible(data,"arg"))this._list_visible[i].style.display="block";else this._list_visible[i].style.display="none"}this.onModelChanged(evt,args)},onModelChanged:function(evt,args){},onModelPropertyChanging:function(evt,args){},onModelPropertyPreChanged:function(evt,args){for(let i=0;i<this._list_property.length;i++){if(this._list_property[i].name==args.name){let trigger=true;switch(this._list_property[i].type){case"radio":if(this._list_property[i].value!=args.value){this._list_property[i].parentElement.classList.remove("active");continue}this._list_property[i].checked=true;this._list_property[i].parentElement.classList.add("active");break;case"checkbox":if(~~args.value){this._list_property[i].checked=true;this._list_property[i].parentElement.classList.add("active")}else{this._list_property[i].checked=false;this._list_property[i].parentElement.classList.remove("active")}break;case"field":this._list_property[i].setValue(args.value);trigger=false;break;default:this._list_property[i].value=args.value;break}if(trigger&&this._list_property[i].onchange)this._list_property[i].onchange()}}this.onModelPropertyChanged(evt,args)},onModelPropertyChanged:function(evt,args){this.dispatch("propertyChanged."+args.name,args);this.dispatch("propertyChanged",args)},onModelPropertyRemoved:function(evt,args){},register:function(name,...protos){var newElement=class extends HTMLElement{constructor(){super();this.invokeConstructor=true;this._super={};for(let i of Object.entries(this.constructor.prototype._super)){this._super[i[0]]={};for(let j of Object.entries(i[1])){this._super[i[0]][j[0]]=j[1].bind(this)}}this.onCreated()}findRoot(){let elem=this.parentElement;while(elem!=null){if("isRoot"in elem&&elem.isRoot)return elem;elem=elem.parentElement}return globalThis}connectedCallback(){if(this.dataset.ref){let root=this.findRoot();if(root){root[this.dataset.ref]=this;this.root=root}}if(this.invokeConstructor){this.invokeConstructor=false;this.__ctor()}if(this.root)this.root.onRefAdded(this.dataset.ref);this.onConnected()}disconnectedCallback(){if(this.dataset.ref&&this.root){this.root.onRefRemoved(this.dataset.ref);root[this.dataset.ref]=null;this.root=null}this.onDisconnected()}};Rin.override(newElement.prototype,Element);const proto={};const _super={};for(let i=0;i<protos.length;i++){if(!protos[i])continue;if(Rin.typeOf(protos[i])=="string"){const name=protos[i];protos[i]=Element.protos[name];if(!protos[i])continue;_super[name]={};for(let f in protos[i]){if(Rin.typeOf(protos[i][f])!="function")continue;_super[name][f]=protos[i][f]}}if("_super"in protos[i])Rin.override(_super,protos[i]._super);Rin.override(newElement.prototype,protos[i]);Rin.override(proto,protos[i])}newElement.prototype._super=_super;proto._super=_super;customElements.define(name,newElement);Element.protos[name]=proto;return newElement}}},{"@rsthn/rin":13}],3:[function(require,module,exports){module.exports={Router:require("./router"),Element:require("./element"),Api:require("./api")}},{"./api":1,"./element":2,"./router":6}],4:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var InvalidCharacterError=function(message){this.message=message};InvalidCharacterError.prototype=new Error;InvalidCharacterError.prototype.name="InvalidCharacterError";var error=function(message){throw new InvalidCharacterError(message)};var TABLE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var REGEX_SPACE_CHARACTERS=/[\t\n\f\r ]/g;var decode=function(input){input=String(input).replace(REGEX_SPACE_CHARACTERS,"");var length=input.length;if(length%4==0){input=input.replace(/==?$/,"");length=input.length}if(length%4==1||/[^+a-zA-Z0-9/]/.test(input)){error("Invalid character: the string to be decoded is not correctly encoded.")}var bitCounter=0;var bitStorage;var buffer;var output="";var position=-1;while(++position<length){buffer=TABLE.indexOf(input.charAt(position));bitStorage=bitCounter%4?bitStorage*64+buffer:buffer;if(bitCounter++%4){output+=String.fromCharCode(255&bitStorage>>(-2*bitCounter&6))}}return output};var encode=function(input){input=String(input);if(/[^\0-\xFF]/.test(input)){error("The string to be encoded contains characters outside of the "+"Latin1 range.")}var padding=input.length%3;var output="";var position=-1;var a;var b;var c;var d;var buffer;var length=input.length-padding;while(++position<length){a=input.charCodeAt(position)<<16;b=input.charCodeAt(++position)<<8;c=input.charCodeAt(++position);buffer=a+b+c;output+=TABLE.charAt(buffer>>18&63)+TABLE.charAt(buffer>>12&63)+TABLE.charAt(buffer>>6&63)+TABLE.charAt(buffer&63)}if(padding==2){a=input.charCodeAt(position)<<8;b=input.charCodeAt(++position);buffer=a+b;output+=TABLE.charAt(buffer>>10)+TABLE.charAt(buffer>>4&63)+TABLE.charAt(buffer<<2&63)+"="}else if(padding==1){buffer=input.charCodeAt(position);output+=TABLE.charAt(buffer>>2)+TABLE.charAt(buffer<<4&63)+"=="}return output};var base64={encode:encode,decode:decode,version:"0.1.0"};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(function(){return base64})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=base64}else{for(var key in base64){base64.hasOwnProperty(key)&&(freeExports[key]=base64[key])}}}else{root.base64=base64}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],5:[function(require,module,exports){(function(global){"use strict";var getGlobal=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var global=getGlobal();module.exports=exports=global.fetch;exports.default=global.fetch.bind(global);exports.Headers=global.Headers;exports.Request=global.Request;exports.Response=global.Response}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],6:[function(require,module,exports){const{EventDispatcher:EventDispatcher}=require("@rsthn/rin");let _Router=module.exports={Route:EventDispatcher.extend({routeRegex:null,value:null,params:null,s_args:null,active:false,changed:false,__ctor:function(route){this._super.EventDispatcher.__ctor();this._compileRoute(this.value=route)},_compileRoute:function(route){this.params=[];while(true){var m=/:([!@A-Za-z0-9_-]+)/.exec(route);if(!m)break;route=route.replace(m[0],"([^/]+)");this.params.push(m[1])}this.routeRegex="^"+route.replace(/##/g,"")},addHandler:function(handler,unrouted){this.addEventListener((unrouted===true?"un":"")+"routed",handler,null)},removeHandler:function(handler,unrouted){this.removeEventListener((unrouted===true?"un":"")+"routed",handler,null)},dispatch:function(route){var matches=route.match(this.routeRegex);if(!matches){this.s_args=null;if(this.active)this.dispatchEvent("unrouted",{route:this});return this.active=false}var args={route:this};var str="";for(var i=0;i<this.params.length;i++){args[this.params[i]]=matches[i+1];str+="_"+matches[i+1]}this.changed=str!=this.s_args;this.dispatchEvent("routed",args);this.s_args=str;return this.active=true}}),routes:{},sortedRoutes:[],ignoreHashchangeEvent:0,location:"",args:[],init:function(){if(this.alreadyAttached)return;this.alreadyAttached=true;if("onhashchange"in globalThis)globalThis.onhashchange=this.onLocationChanged.bind(this)},refresh:function(){this.onLocationChanged()},setRoute:function(route,silent){var location=_Router.realLocation(route);if(location==this.location)return;if(silent)this.ignoreHashchangeEvent++;globalThis.location.hash=location},addRoute:function(route,onRoute,onUnroute){if(!this.routes[route]){this.routes[route]=new _Router.Route(route);this.sortedRoutes.push(route);this.sortedRoutes.sort(function(a,b){return _Router.routes[a].routeRegex.length-_Router.routes[b].routeRegex.length})}if(onUnroute!==undefined){this.routes[route].addHandler(onRoute,false);this.routes[route].addHandler(onUnroute,true)}else this.routes[route].addHandler(onRoute,false)},addRoutes:function(routes){for(var i in routes){if(!this.routes[i]){this.routes[i]=new _Router.Route(i);this.sortedRoutes.push(i)}this.routes[i].addHandler(routes[i],false)}this.sortedRoutes.sort(function(a,b){return _Router.routes[a].routeRegex.length-_Router.routes[b].routeRegex.length})},removeRoute:function(route,onRoute,onUnroute){if(!this.routes[route])return;if(onUnroute!==undefined){this.routes[route].removeHandler(onRoute,false);this.routes[route].removeHandler(onUnroute,true)}else this.routes[route].removeHandler(onRoute)},removeRoutes:function(routes){for(var i in routes){if(!this.routes[i])continue;this.routes[i].removeHandler(routes[i])}},realLocation:function(cLocation,pLocation){if(!pLocation)pLocation=this.location;if(!pLocation)pLocation=" ";var state=0,i=0,j=0,k;var rLocation="";while(state!=-1&&i<cLocation.length&&j<pLocation.length){switch(state){case 0:if(cLocation.substr(i++,1)=="*"){state=1;break}if(cLocation.substr(i-1,1)!=pLocation.substr(j++,1)){rLocation+=cLocation.substr(i-1);state=-1;break}rLocation+=pLocation.substr(j-1,1);break;case 1:if(cLocation.substr(i,1)=="*"){state=3;i++;break}state=2;break;case 2:k=pLocation.indexOf(cLocation.substr(i,1),j);if(k==-1){rLocation+=pLocation.substr(j)+cLocation.substr(i);state=-1;break}rLocation+=pLocation.substr(j,k-j);state=0;j=k;break;case 3:k=pLocation.lastIndexOf(cLocation.substr(i,1));if(k==-1){rLocation+=cLocation.substr(i);state=-1;break}rLocation+=pLocation.substr(j,k-j);state=0;j=k;break}}if(state!=-1)rLocation+=cLocation.substr(i);return rLocation.trim()},onLocationChanged:function(){var cLocation=location.hash.substr(1);var rLocation=_Router.realLocation(cLocation);if(cLocation!=rLocation){globalThis.location.replace("#"+rLocation);return}this.location=cLocation;this.args=this.location.split("/");if(this.ignoreHashchangeEvent>0){this.ignoreHashchangeEvent--;return}for(var i=0;i<this.sortedRoutes.length;i++)this.routes[this.sortedRoutes[i]].dispatch(this.location)}};_Router.init()},{"@rsthn/rin":13}],7:[function(require,module,exports){let Rin=module.exports={};Rin.invokeLater=function(fn){if(fn)setTimeout(function(){fn()},10)};Rin.typeOf=function(o){if(o instanceof Array)return"array";if(o===null)return"null";return(typeof o).toString().toLowerCase()};Rin.isArrayOrObject=function(o){switch(Rin.typeOf(o)){case"array":case"object":return true}return false};Rin.clone=function(elem){var o;if(Rin.typeOf(elem)=="array"){o=[];for(let i=0;i<elem.length;i++)o.push(Rin.clone(elem[i]))}else if(Rin.typeOf(elem)=="object"){o={};for(let i in elem)o[i]=Rin.clone(elem[i])}else{o=elem}return o};Rin.merge=function(output,...objs){if(Rin.typeOf(output)=="array"){for(let i=0;i<objs.length;i++){let arr=objs[i];if(Rin.typeOf(arr)!="array"){output.push(arr)}else{for(let j=0;j<arr.length;j++){output.push(Rin.clone(arr[j]))}}}}else if(Rin.typeOf(output)=="object"){for(let i=0;i<objs.length;i++){let obj=objs[i];if(Rin.typeOf(obj)!="object")continue;for(let field in obj){if(Rin.isArrayOrObject(obj[field])){if(field in output)Rin.merge(output[field],obj[field]);else output[field]=Rin.clone(obj[field])}else output[field]=obj[field]}}}return output};Rin.override=function(output,...objs){for(let i=0;i<objs.length;i++){for(let j in objs[i]){output[j]=objs[i][j]}}return output};Rin.partialCompare=function(full,partial){if(full==null||partial==null)return false;if(full===partial)return true;for(var i in partial){if(full[i]!=partial[i])return false}return true};Rin.arrayFind=function(arr,o,getObject){for(var i=0;arr&&i<arr.length;i++){if(this.partialCompare(arr[i],o))return getObject?arr[i]:i}return getObject?null:false};Rin.indexOf=function(container,value){for(let i in container){if(container[i]==value)return i}return-1};Rin.escape=function(str){return(str+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};Rin.ensureTypeOf=function(m,o){if(!o||!m||o instanceof m)return o;if(o.isInstanceOf&&m.prototype.className){if(o.isInstanceOf(m.prototype.className))return o}return new m(o)};Rin.serialize=function(o){return JSON.stringify(o)};Rin.deserialize=function(s){return JSON.parse(s)}},{}],8:[function(require,module,exports){let Rin=require("./alpha");module.exports=Class=function(){};Class._class=Class;Class._super={};Class.prototype.className="Class";Class.prototype.__ctor=function(){};Class.prototype.__init=function(){};Class.prototype.isInstanceOf=function(className){className=Rin.typeOf(className)=="string"?className:className.prototype?className.prototype.className:className.constructor.prototype.className;return className in this._super?true:this.className==className};Class.prototype._initSuperRefs=function(){var _super=this.constructor._super;var _newSuper={};for(let i in _super){let o={};let _prot=_super[i].prototype;for(let j in _prot){if(Rin.typeOf(_prot[j])=="function")o[j]=_prot[j].bind(this)}_newSuper[i]=o}this._super=_newSuper};Class.inherit=function(proto){var self=this._class;var _super=self._super;var _class=self._class;if(Rin.typeOf(proto)=="function"){for(let i in proto._class)if(!/^[A-Z]/.test(i))self[i]=proto._class[i];Rin.override(self.prototype,proto._class.prototype);Rin.override(_super,proto._class._super);if(proto._class.prototype.className)_super[proto._class.prototype.className]=proto._class}else{Rin.override(self.prototype,proto)}self._super=_super;self._class=_class;return self};Class.prototype._extend=function(base,protos){var _class=function(...args){this._initSuperRefs();this.__ctor.apply(this,args)};_class._class=_class;_class._super={};Class.inherit.call(_class,base);delete _class.prototype.className;for(let i=0;i<protos.length;i++)_class.inherit(protos[i]);delete _class._super.Class;if("classInit"in _class.prototype)_class.prototype.classInit();return _class};Class.extend=function(...protos){return this._class.prototype._extend(this,protos)};Class.create=function(proto){return new(this.extend(proto))}},{"./alpha":7}],9:[function(require,module,exports){let Flattenable=require("./flattenable");let Schema=require("./schema");let Rin=require("./alpha");module.exports=Flattenable.extend({className:"Collection",itemTypeSchema:null,items:null,__ctor:function(itemTypeSchema){if(!itemTypeSchema)itemTypeSchema=this.itemTypeSchema;if(itemTypeSchema)this.typeSchema=Schema.Property("items").is(Schema.Array().of(itemTypeSchema));this.reset()},onUnflattened:function(){let items=this.items;this.reset();for(let i of items)this.add(i)},reset:function(){this.items=[];return this},clear:function(){var items=this.items;this.reset();for(var i=0;i<items.length;i++)this.onItemRemoved(items[i],0);return this},sort:function(fn,desc){if(typeof fn!="function"){this.items.sort(function(a,b){return(a[fn]<=b[fn]?-1:1)*(desc===true?-1:1)})}else this.items.sort(fn);return this},findItem:function(inc,exc){if(!this.items)return null;for(var i=0;i<this.items.length;i++){if(exc&&Rin.partialCompare(this.items[i],exc))continue;if(Rin.partialCompare(this.items[i],inc))return this.items[i]}return null},getItems:function(){return this.items},count:function(){return this.items.length},isEmpty:function(){return!this.items.length},add:function(item){if(!item||!this.onBeforeItemAdded(item))return this;this.items.push(item);this.onItemAdded(item);return this},addAt:function(index,item){if(!item||!this.onBeforeItemAdded(item))return this;if(index<0)index=0;if(index>this.items.length)index=this.items.length;if(index==0){this.items.unshift(item)}else if(index==this.items.length){this.items.push(item)}else{var tmp=this.items.splice(0,index);tmp.push(item);this.items=tmp.concat(this.items)}this.onItemAdded(item);return this},addItems:function(list){if(!list)return this;for(var i=0;i<list.length;i++)this.add(list[i]);return this},indexOf:function(item){return this.items.indexOf(item)},getAt:function(index,rel){if(index<0&&rel==true)index+=this.items.length;return index>=0&&index<this.items.length?this.items[index]:null},removeAt:function(index){if(index<0||index>=this.items.length)return this;var item=this.items[index];this.items.splice(index,1);this.onItemRemoved(item,index);return this},remove:function(item){this.removeAt(this.indexOf(item))},forEach:function(callback){if(this.isEmpty())return this;for(var i=0;i<this.items.length;i++)if(callback(this.items[i],i,this)===false)break;return this},forEachCall:function(method,...args){if(this.isEmpty())return this;for(var i=0;i<this.items.length;i++)if(this.items[i][method](...args)===false)break;return this},forEachRev:function(callback){if(this.isEmpty())return this;for(var i=this.items.length-1;i>=0;i--)if(callback(this.items[i],i,this)===false)break;return this},forEachRevCall:function(method,...args){if(this.isEmpty())return this;for(var i=this.items.length-1;i>=0;i--)if(this.items[i][method](...args)===false)break;return this},onBeforeItemAdded:function(item){return true},onItemAdded:function(item){},onItemRemoved:function(item){}})},{"./alpha":7,"./flattenable":12,"./schema":18}],10:[function(require,module,exports){let Class=require("./class");let Event=require("./event");module.exports=Class.extend({className:"EventDispatcher",listeners:null,__ctor:function(){this.listeners={}},addEventListener:function(eventName,handler,context,data){eventName=eventName.split(":");var name=eventName[eventName.length-1];var ns=eventName.length>1?eventName[0]:null;if(!this.listeners[name])this.listeners[name]=[];this.listeners[name].push({ns:ns,handler:handler,context:context,data:data,silent:0});return this},removeEventListener:function(eventName,handler,context){eventName=eventName.split(":");var name=eventName[eventName.length-1];var ns=eventName.length>1?eventName[0]:null;if(name=="*"){for(var j in this.listeners){var list=this.listeners[j];for(var i=0;i<list.length;i++){var k=true;if(handler)k=k&&list[i].handler===handler;if(context)k=k&&list[i].context===context;if(ns)k=k&&list[i].ns==ns;if(k)list.splice(i--,1)}}}else{if(!this.listeners[name])return this;var list=this.listeners[name];for(var i=0;i<list.length;i++){var k=true;if(handler)k=k&&list[i].handler===handler;if(context)k=k&&list[i].context===context;if(ns)k=k&&list[i].ns==ns;if(k)list.splice(i--,1)}}return this},prepareEvent:function(eventName,eventArgs,cbHandler,cbContext){var list=[];eventName=eventName.split(":");var name=eventName[eventName.length-1];var ns=eventName.length>1?eventName[0]:null;if(this.listeners[name])list=list.concat(this.listeners[name]);if(this.listeners["*"])list=list.concat(this.listeners["*"]);for(var i=0;i<list.length;i++)if(list[i].silent)list.splice(i--,1);if(ns){for(var i=0;i<list.length;i++)if(list[i].ns!=ns)list.splice(i--,1)}return new Event(this,list,name,eventArgs,cbHandler,cbContext)},silence:function(eventName,value){eventName=eventName.split(":");var name=eventName[eventName.length-1];var ns=eventName.length>1?eventName[0]:null;value=value===false?-1:1;if(name=="*"){for(var j in this.listeners){var list=this.listeners[j];for(var i=0;i<list.length;i++){if(ns&&list[i].ns!=ns)continue;list[i].silent+=value}}}else{if(!this.listeners[name])return this;var list=this.listeners[name];for(var i=0;i<list.length;i++){if(ns&&list[i].ns!=ns)continue;list[i].silent+=value}}return this},dispatchEvent:function(eventName,eventArgs,cbHandler,cbContext){return this.prepareEvent(eventName,eventArgs,cbHandler,cbContext).resume()}})},{"./class":8,"./event":11}],11:[function(require,module,exports){let Rin=require("./alpha");let Class=require("./class");module.exports=Class.extend({className:"Event",source:null,name:null,args:null,_async:false,list:null,next:null,ret:null,original:null,i:-1,__ctor:function(source,list,eventName,eventArgs,cbHandler,cbContext){this.source=source;this.name=eventName;this.args=eventArgs;this.cbHandler=cbHandler;this.cbContext=cbContext;this.list=list;this.reset()},reset:function(){this.next=null;this.ret=[];this._async=false;this.i=-1;return this},wait:function(){this._async=true;return this},resume:function(){this._async=false;while(!this._async){if(++this.i>=this.list.length)break;if(this.list[this.i].silent)continue;if(Rin.typeOf(this.list[this.i].handler)=="string"){if(this.list[this.i].context){if(!this.list[this.i].context[this.list[this.i].handler])continue;if(this.list[this.i].context[this.list[this.i].handler](this,this.args,this.list[this.i].data)===false)break}else{if(globalThis[this.list[this.i].handler].call(null,this,this.args,this.list[this.i].data)===false)break}}else{if(this.list[this.i].handler.call(this.list[this.i].context,this,this.args,this.list[this.i].data)===false)break}}if(this._async)return this;if(this.i>=this.list.length&&this.next)this.next.resume();if(this.cbHandler)this.cbHandler.call(this.cbContext);return this},from:function(event){this.original=event;return this},enqueue:function(event){if(!event)return this;var evt;for(evt=this;evt.next!=null;evt=evt.next);evt.next=event;event.from(this);return this}})},{"./alpha":7,"./class":8}],12:[function(require,module,exports){let Class=require("./class");module.exports=Class.extend({className:"Flattenable",typeSchema:null,flatten:function(context){return this.typeSchema.flatten(this,context)},unflatten:function(value,context){Object.assign(this,this.typeSchema.unflatten(value,context));this.onUnflattened();return this},onUnflattened:function(){}})},{"./class":8}],13:[function(require,module,exports){let Rin=require("./alpha");Rin.Rin=Rin;Rin.Class=require("./class");Rin.Event=require("./event");Rin.EventDispatcher=require("./event-dispatcher");Rin.Model=require("./model");Rin.Model.List=require("./model-list");Rin.Schema=require("./schema");Rin.Flattenable=require("./flattenable");Rin.Collection=require("./collection");Rin.Template=require("./template");Object.assign(module.exports,Rin)},{"./alpha":7,"./class":8,"./collection":9,"./event":11,"./event-dispatcher":10,"./flattenable":12,"./model":17,"./model-list":15,"./schema":18,"./template":19}],14:[function(require,module,exports){let Rin=require("./alpha");let Regex=require("./model-regex");module.exports={_getref:function(value,obj){if(typeof value=="string"){if(value.substr(0,1)=="#")value=obj.get(value.substr(1));else if(value.substr(0,1)=="@")value=obj[value.substr(1)];if(typeof value=="string")return eval(value);return value}else return value},type:function(model,ctval,name,value){switch(ctval){case"int":value=parseInt(value);if(isNaN(value))throw new Error(ctval);break;case"float":value=parseFloat(value);if(isNaN(value))throw new Error(ctval);break;case"string":value=value===null||value===undefined?"":value.toString();break;case"bit":if(value===true||value===false){value=value?1:0;break}value=parseInt(value);if(isNaN(value))throw new Error(ctval);value=value?1:0;break;case"array":if(Rin.typeOf(value)=="array")break;if(value===null||value===undefined){value=[];break}throw new Error(ctval);break;case"bool":if(value==="true"||value===true){value=true;break}if(value==="false"||value===false){value=false;break}throw new Error(ctval);break}return value},model:function(model,ctval,name,value){var mclass=this._getref(ctval,model);if(!mclass)throw new Error(ctval);if(!value)return new mclass;return mclass.ensure(value)},cls:function(model,ctval,name,value){var mclass=this._getref(ctval,model);if(!value)return new mclass;return Rin.ensureTypeOf(mclass,value)},arrayof:function(model,ctval,name,value){var mclass=this._getref(ctval,model);if(!value)value=[];if(!mclass||Rin.typeOf(value)!="array")throw new Error(ctval);for(var i=0;i<value.length;i++)value[i]=Rin.ensureTypeOf(mclass,value[i]);return value},arraynull:function(model,ctval,name,value){var remove=false;if(Rin.typeOf(ctval)=="object"){if(ctval.remove)remove=ctval.remove;ctval=ctval.value}if(ctval)return value;if(Rin.typeOf(value)!="array")throw new Error(ctval);for(var i=0;i<value.length;i++){if(value[i]==null){if(remove)value.splice(i--,1);else throw new Error(ctval)}}return value},arraycompliant:function(model,ctval,name,value){var remove=false;if(Rin.typeOf(ctval)=="object"){if(ctval.remove)remove=ctval.remove;ctval=ctval.value}if(!ctval)return value;if(Rin.typeOf(value)!="array")throw new Error(ctval);for(var i=0;i<value.length;i++){if(value[i]==null)continue;if(!value[i].isCompliant()){if(remove)value.splice(i--,1);else throw new Error(ctval)}}return value},required:function(model,ctval,name,value){if(value===null||value===undefined)throw new Error(ctval?"":"null");switch(Rin.typeOf(value)){case"array":if(value.length==0)throw new Error(ctval?"":"null");break;default:if(value.toString().length==0)throw new Error(ctval?"":"null");break}return value},minlen:function(model,ctval,name,value){if(value.toString().length<ctval)throw new Error(ctval);return value},maxlen:function(model,ctval,name,value){if(value.toString().length>ctval)throw new Error(ctval);return value},minval:function(model,ctval,name,value){if(parseFloat(value)<ctval)throw new Error(ctval);return value},maxval:function(model,ctval,name,value){if(parseFloat(value)>ctval)throw new Error(ctval);return value},mincount:function(model,ctval,name,value){if(Rin.typeOf(value)!="array"||value.length<ctval)throw new Error(ctval);return value},maxcount:function(model,ctval,name,value){if(Rin.typeOf(value)!="array"||value.length>ctval)throw new Error(ctval);return value},pattern:function(model,ctval,name,value){if(!Regex[ctval].test(value.toString()))throw new Error(ctval);return value},inset:function(model,ctval,name,value){if(Rin.typeOf(ctval)!="array"){if(!new RegExp("^("+ctval.toString()+")$").test(value.toString()))throw new Error(ctval);return value}if(ctval.indexOf(value.toString())==-1)throw new Error(ctval.join("|"));return value},upper:function(model,ctval,name,value){return ctval?value.toString().toUpperCase():value},lower:function(model,ctval,name,value){return ctval?value.toString().toLowerCase():value}}},{"./alpha":7,"./model-regex":16}],15:[function(require,module,exports){let Rin=require("./alpha");let Model=require("./model");module.exports=Model.extend({className:"List",itemt:Model,contents:null,defaults:{contents:null},constraints:{contents:{type:"array",arrayof:"@itemt"}},ready:function(){this._eventGroup="ModelList_"+Date.now()+":modelChanged";this.contents=this.data.contents},_bind:function(index,item){if(item&&item.addEventListener)item.addEventListener(this._eventGroup,this._onItemEvent,this,index);return item},_unbind:function(item){if(item&&item.removeEventListener)item.removeEventListener(this._eventGroup);return item},_onItemEvent:function(evt,args,data){this.prepareEvent("itemChanged",{index:data,item:evt.source}).from(evt).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume()},count:function(){return this.data.contents.length},clear:function(){for(var i=0;i<this.data.contents;i++)this._unbind(this.data.contents[i]);this.data.contents=[];this.prepareEvent("itemCleared").enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume()},setData:function(data){this.clear();if(!data)return;for(var i=0;i<data.length;i++){var item=Rin.ensureTypeOf(this.itemt,data[i]);this._bind(i,item);this.data.contents.push(item)}this.prepareEvent("itemsChanged").enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume()},getData:function(){return this.data.contents},getAt:function(index){if(index<0||index>=this.data.contents.length)return null;return Rin.ensureTypeOf(this.itemt,this.data.contents[index])},removeAt:function(index){if(index<0||index>=this.data.contents.length)return null;var item=Rin.ensureTypeOf(this.itemt,this.data.contents.splice(index,1)[0]);this._unbind(item);this.prepareEvent("itemRemoved",{index:index,item:item}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume();return item},setAt:function(index,item){if(index<0||index>=this.data.contents.length)return false;item=Rin.ensureTypeOf(this.itemt,item);this.data.contents[index]=item;this._bind(index,item);this.prepareEvent("itemChanged",{index:index,item:item}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume();return true},updateAt:function(index){if(index<0||index>=this.data.contents.length)return false;this.prepareEvent("itemChanged",{index:index,item:this.data.contents[index]}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume();return true},push:function(item){if(item&&Rin.typeOf(item)!="object")return null;item=Rin.ensureTypeOf(this.itemt,item);this.data.contents.push(item);this._bind(this.data.contents.length-1,item);this.prepareEvent("itemAdded",{index:this.data.contents.length-1,item:item}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume();return item},pop:function(){return this._unbind(Rin.ensureTypeOf(this.itemt,this.data.contents.pop()))},unshift:function(item){if(item&&Rin.typeOf(item)!="object")return null;item=Rin.ensureTypeOf(this.itemt,item);this.data.contents.unshift(item);this._bind(0,item);this.prepareEvent("itemAdded",{index:0,item:item}).enqueue(this.prepareEvent("modelChanged",{fields:["contents"]})).resume();return item},shift:function(){return this._unbind(Rin.ensureTypeOf(this.itemt,this.data.contents.shift()))},find:function(data,retObject){var contents=this.data.contents;for(var i=0;i<contents.length;i++){if(Rin.partialCompare(contents[i].data,data))return retObject?contents[i]:i}return retObject?null:-1}})},{"./alpha":7,"./model":17}],16:[function(require,module,exports){module.exports={email:/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)+$/i,url:/^[\w-]+:\/\/[\w-]+(\.\w+)+.*$/,urlNoProt:/^[\w-]+(\.\w+)+.*$/,name:/^[-A-Za-z0-9_.]+$/,uname:/^['\pL\pN ]+$/,text:/^[^&<>{}]*$/,utext:/^([\r\n\pL\pN\pS &!@#$%*\[\]()_+=;',.\/?:"~-]+)$/}},{}],17:[function(require,module,exports){let Rin=require("./alpha");let EventDispatcher=require("./event-dispatcher");let _Model=module.exports=EventDispatcher.extend({className:"Model",defaults:null,constraints:null,data:null,changedList:null,_silent:0,_level:0,__ctor:function(data,defaults){this._super.EventDispatcher.__ctor();this.data={};if(defaults!=null){this.reset(defaults)}else{var o=null;if(!this.defaults&&this.constraints){var o={};for(var i in this.constraints){var j=this.constraints[i];if(j.def===null||j.def===undefined){o[i]=null;continue}if(typeof j.def=="function")o[i]=j.def();else o[i]=j.def}}this.reset(o)}this.init();if(data!=null)this.set(arguments[0],true);if(this.constraints)this.update();this.ready()},reset:function(defaults,nsilent){if(!this.defaults){if(!defaults||Rin.typeOf(defaults)!="object"&&Rin.typeOf(defaults)!="function")return this;this.defaults=defaults}if(Rin.typeOf(this.defaults)=="function")this.data=this.defaults();else this.data=Rin.clone(this.defaults);return nsilent===false||defaults===false?this:this.update(null,true)},init:function(){},ready:function(){},silent:function(value){this._silent+=value?1:-1;return this},_validate:function(name,value){if(!this.constraints||!this.constraints[name])return value;var constraints=this.constraints[name];var nvalue=value;for(var ctname in constraints){if(!_Model.Constraints[ctname])continue;try{nvalue=_Model.Constraints[ctname](this,constraints[ctname],name,nvalue)}catch(e){if(e.message=="null")break;throw new Error(`Constraint [${ctname}:${constraints[ctname]}] failed on property '${name}'.`)}}return nvalue},_set:function(name,value){if(!this.constraints||!this.constraints[name]){this.data[name]=value;return value}var constraints=this.constraints[name];var cvalue=this.data[name];var nvalue=value;for(var ctname in constraints){if(!_Model.Constraints[ctname])continue;try{nvalue=_Model.Constraints[ctname](this,constraints[ctname],name,nvalue)}catch(e){if(e.message=="null")break;if(!this._silent)this.dispatchEvent("constraintError",{constraint:ctname,message:e.message,name:name,value:value});break}}return this.data[name]=nvalue},_propertyEvent:function(name,prev,value,direct){var temp={name:name,old:prev,value:value,level:this._level};var evt=this.dispatchEvent("propertyChanging",temp);if(!direct)temp.value=this._set(name,temp.value);else this.data[name]=temp.value;if(evt!=null&&evt.ret.length&&evt.ret[0]===false)return;this.dispatchEvent("propertyChanged."+name,temp);this.dispatchEvent("propertyChanged",temp);this.changedList.push(name)},set:function(){var n=arguments.length;var force=false,silent=false;if((n>2||n==2&&Rin.typeOf(arguments[0])=="object")&&Rin.typeOf(arguments[n-1])=="boolean"){force=arguments[--n];if(force===false)silent=true}if(this._level==0){this.changedList=[]}this._level++;if(n==2){if(this.data[arguments[0]]!=arguments[1]||force){if(!this._silent&&!silent)this._propertyEvent(arguments[0],this.data[arguments[0]],this._validate(arguments[0],arguments[1]));else this._set(arguments[0],arguments[1])}}else{for(var i in arguments[0]){if(this.data[i]!=arguments[0][i]||force){if(!this._silent&&!silent)this._propertyEvent(i,this.data[i],this._validate(i,arguments[0][i]));else this._set(i,arguments[0][i])}}}if(!--this._level&&this.changedList.length&&!silent&&!this._silent)this.dispatchEvent("modelChanged",{fields:this.changedList});return this},get:function(name,def){if(arguments.length==0||name===false)return this.data;if(arguments.length==1&&name===true)return this.flatten();if(arguments.length==2)return this.data[name]===undefined?def:this.data[name];return this.data[name]},getInt:function(name,def){if(arguments.length==2)return this.data[name]===undefined?def:parseInt(this.data[name]);return parseInt(this.data[name])},getFloat:function(name,def){if(arguments.length==2)return this.data[name]===undefined?def:parseFloat(this.data[name]);return parseFloat(this.data[name])},getBool:function(name,def){if(arguments.length==2)name=this.data[name]===undefined?def:this.data[name];else name=this.data[name];if(name==="true"||name===true)return true;if(name==="false"||name===false)return false;return parseInt(name)?true:false},getReference:function(name){var m=this;return{get:function(){return m.get(name)},set:function(value){m.set(name,value)}}},constraint:function(field,constraint,value){if(arguments.length==3||arguments.length==2||arguments.length==1&&Rin.typeOf(field)=="object"){if(this.constraints===this.constructor.prototype.constraints)this.constraints=Rin.clone(this.constraints);switch(arguments.length){case 1:Rin.override(this.constraints,field);break;case 2:Rin.override(this.constraints[field],constraint);break;case 3:this.constraints[field][constraint]=value;break}return this}return!field?this:this.constraints[field]},flatten:function(safe,rsafe){if(safe){var data=this.flatten(false,true);if(data==null)return null;data["class"]=this.classPath;return data}if(!this.constraints&&!this.defaults)return this.data;if(!this.isCompliant())return{};var constraints=this.constraints;var keys=this.defaults?Rin.typeOf(this.defaults)=="function"?this.defaults():this.defaults:this.constraints;var data={};for(var i in this.data){if(!(i in keys))continue;if(constraints&&constraints[i]){var ct=constraints[i];if(ct.model){data[i]=this.data[i]?this.data[i].flatten(rsafe):null;continue}if(ct.arrayof){data[i]=[];for(var j=0;j<this.data[i].length;j++)data[i][j]=this.data[i][j]?this.data[i][j].flatten(rsafe):null;continue}if(ct.cls){data[i]=this.data[i]?this.data[i].flatten():null;continue}}data[i]=this.data[i]}return data},remove:function(name,nsilent){if(Rin.typeOf(name)=="array"){for(var i=0;i<name.length;i++)delete this.data[name[i]];if(nsilent!==false&&!this._silent)this.dispatchEvent("propertyRemoved",{fields:name})}else{delete this.data[name];if(nsilent!==false&&!this._silent)this.dispatchEvent("propertyRemoved",{fields:[name]})}},update:function(fields,direct){if(this._silent)return this;if(this._level==0){this.changedList=[]}this._level++;if(fields&&Rin.typeOf(fields)=="string"){this._propertyEvent(fields,this.data[fields],this.data[fields],direct)}else{for(var i in this.data){if(fields&&Rin.indexOf(fields,i)==-1)continue;this._propertyEvent(i,this.data[i],this.data[i],direct)}}if(!--this._level&&this.changedList.length&&!this._silent)this.dispatchEvent("modelChanged",{fields:this.changedList});return this},validate:function(fields){if(!this.constraints)return this;if(fields&&Rin.typeOf(fields)=="string"){this._set(fields,this.data[fields])}else{for(var i in this.data){if(fields&&Rin.indexOf(fields,i)==-1)continue;this._set(i,this.data[i])}}return this},isCompliant:function(){if(!this.constraints)return true;try{for(var i in this.data)this._validate(i,this.data[i]);return true}catch(e){}return false},observe:function(property,handler,context){this.addEventListener("propertyChanged."+property,handler,context)},unobserve:function(property,handler,context){this.removeEventListener("propertyChanged."+property,handler,context)},toString:function(){return Rin.serialize(this.get(true))}});_Model.Constraints=require("./model-constraints")},{"./alpha":7,"./event-dispatcher":10,"./model-constraints":14}],18:[function(require,module,exports){let Rin=require("./alpha");let Schema=module.exports={Type:function(proto){let tmp={flatten:function(value,context){return value},unflatten:function(value,context){return value}};return proto?Rin.override(tmp,proto):tmp},String:function(){return Schema.Type({flatten:function(value,context){return value!=null?value.toString():null},unflatten:function(value,context){return value!=null?value.toString():null}})},Integer:function(){return Schema.Type({flatten:function(value,context){return~~value},unflatten:function(value,context){return~~value}})},Numeric:function(precision){return Schema.Type({_precision:precision,_round:false,precision:function(value){this._precision=~~value;return this},flatten:function(value,context){value=parseFloat(value);if(this._precision>0)value=~~(value*Math.pow(10,this._precision))/Math.pow(10,this._precision);return value},unflatten:function(value,context){return parseFloat(value)}})},Bool:function(compact){return Schema.Type({_compact:compact,compact:function(value){this._compact=value;return this},flatten:function(value,context){value=~~value;return this._compact?value>0?1:0:value>0?true:false},unflatten:function(value,context){return~~value?true:false}})},SharedString:function(){return Schema.Type({flatten:function(value,context){if(value==null)return 0;value=value.toString();if(!("strings"in context)){context.strings_map={};context.strings=[]}if(!(value in context.strings_map)){context.strings.push(value);context.strings_map[value]=context.strings.length}return context.strings_map[value]},unflatten:function(value,context){return value==null||value==0?null:context.strings[~~value-1]}})},Array:function(type){return Schema.Type({itemType:type,of:function(type){this.itemType=type;return this},flatten:function(value,context){if(value==null)return null;let o=[];for(let i=0;i<value.length;i++)o.push(this.itemType.flatten(value[i],context));return o},unflatten:function(value,context){if(value==null)return null;let o=[];for(let i=0;i<value.length;i++)o.push(this.itemType.unflatten(value[i],context));return o}})},Object:function(){return Schema.Type({properties:[],property:function(name,type){this.properties.push({name:name,type:type});return this},flatten:function(value,context){if(value==null)return null;let o;if(context.symbolic===true){o={};for(let i=0;i<this.properties.length;i++){o[this.properties[i].name]=this.properties[i].type.flatten(value[this.properties[i].name],context)}}else{o=[];for(let i=0;i<this.properties.length;i++){o.push(this.properties[i].type.flatten(value[this.properties[i].name],context))}}return o},unflatten:function(value,context){if(value==null)return null;let o={};if(context.symbolic===true){for(let i=0;i<this.properties.length;i++){o[this.properties[i].name]=this.properties[i].type.unflatten(value[this.properties[i].name],context)}}else{for(let i=0;i<this.properties.length;i++){o[this.properties[i].name]=this.properties[i].type.unflatten(value[i],context)}}return o}})},Class:function(classConstructor){return Schema.Type({_constructor:classConstructor,constructor:function(classConstructor){this._constructor=classConstructor;return this},flatten:function(value,context){return value==null?null:value.flatten(context)},unflatten:function(value,context){return value==null?null:(new this._constructor).unflatten(value,context)}})},Property:function(name,type){return Schema.Type({property:name,type:type,name:function(name){this.property=name;return this},is:function(type){this.type=type;return this},flatten:function(value,context){if(value==null)return null;let o;if(context.symbolic===true){o={};o[this.property]=this.type.flatten(value[this.property],context)}else{o=this.type.flatten(value[this.property],context)}return o},unflatten:function(value,context){if(value==null)return null;let o={};if(context.symbolic===true)o[this.property]=this.type.unflatten(value[this.property],context);else o[this.property]=this.type.unflatten(value,context);return o}})}}},{"./alpha":7}],19:[function(require,module,exports){let Template=module.exports={parseTemplate:function(template,sym_open,sym_close,is_tpl){let nflush="string",flush=null,state=0,count=0;let str="",nstr="";let parts=[],mparts=parts,nparts=false;if(is_tpl===true){template=template.trim();state=2;mparts.push(parts=[])}template+="\0";for(let i=0;i<template.length;i++){switch(state){case 0:if(template[i]=="\0"){flush="string"}else if(template[i]==sym_open&&template[i+1]=="<"){state=count=1;flush="string";nflush="parse-string-and-merge"}else if(template[i]==sym_open&&template[i+1]=="@"){state=count=1;flush="string";nflush="parse-string-and-merge";i++}else if(template[i]==sym_open&&template[i+1]==":"){state=4;count=1;flush="string";nflush="string";i++}else if(template[i]==sym_open){state=count=1;flush="string";nflush="parse-template"}else{str+=template[i]}break;case 1:if(template[i]=="\0"){throw new Error("Parse error: Unexpected end of template")}if(template[i]==sym_close){count--;if(count<0)throw new Error("Parse error: Unmatched "+sym_close);if(count==0){state=0;flush=nflush;break}}else if(template[i]==sym_open){count++}str+=template[i];break;case 2:if(template[i]=="\0"){flush=nflush;break}else if(template[i]=="."){flush=nflush;nflush="string";break}else if(template[i].match(/[\t\n\r\f\v ]/)!=null){flush=nflush;nflush="string";nparts=true;while(template[i].match(/[\t\n\r\f\v ]/)!=null)i++;i--;break}else if(template[i]==sym_open&&template[i+1]=="<"){if(str)flush=nflush;state=3;count=1;nflush="parse-string-and-merge";break}else if(template[i]==sym_open&&template[i+1]=="@"){if(str)flush=nflush;state=3;count=1;nflush="parse-string-and-merge";i++;break}else if(template[i]==sym_open&&template[i+1]==":"){if(str)flush=nflush;state=5;count=1;nflush="string";i++;break}else if(template[i]==sym_open){if(str){flush=nflush;nstr=template[i]}state=3;count=1;nflush="parse-string";if(str)break}str+=template[i];break;case 3:if(template[i]=="\0")throw new Error("Parse error: Unexpected end of template");if(template[i]==sym_close){count--;if(count<0)throw new Error("Parse error: Unmatched "+sym_close);if(count==0){state=2;if(nflush=="parse-string-and-merge")break}}else if(template[i]==sym_open){count++}str+=template[i];break;case 4:if(template[i]=="\0")throw new Error("Parse error: Unexpected end of template");if(template[i]==sym_close){count--;if(count<0)throw new Error("Parse error: Unmatched "+sym_close);if(count==0){if(str.length!=0){if(!(str[0]=="<"||str[0]=="["||str[0]==" "))str=sym_open+str+sym_close}state=0;flush=nflush;break}}else if(template[i]==sym_open){count++}str+=template[i];break;case 5:if(template[i]=="\0")throw new Error("Parse error: Unexpected end of template");if(template[i]==sym_close){count--;if(count<0)throw new Error("Parse error: Unmatched "+sym_close);if(count==0){if(!(str[0]=="<"||str[0]=="["||str[0]==" "))str=sym_open+str+sym_close;state=2;break}}else if(template[i]==sym_open){count++}str+=template[i];break}if(flush!=null){if(flush=="parse-template"){str=Template.parseTemplate(str,sym_open,sym_close,true)}else if(flush=="parse-string"){str=Template.parseTemplate(str,sym_open,sym_close,false);str=str[0]}else if(flush=="parse-string-and-merge"){str=Template.parseTemplate(str,sym_open,sym_close,false)}if(typeof str!="string"||str.length!=0){if(flush=="parse-string-and-merge"){for(let i=0;i<str.length;i++)parts.push(str[i])}else parts.push(str)}if(nparts){mparts.push(parts=[]);nparts=false}flush=null;str=nstr;nstr=""}}return mparts},parse:function(template){return this.parseTemplate(template.trim(),"[","]",false)},expand:function(parts,data,mode){if(mode=="var"){parts=Template.expand(parts,data,"obj");if(parts[0]=="nl")return"\n";let escape=true;let quote=false;while(true){if(parts[0][0]=="$"){parts[0]=parts[0].substr(1);quote=true}else if(parts[0][0]=="!"){parts[0]=parts[0].substr(1);escape=false}else break}let i=0;if(parts[i]=="this")i++;for(;i<parts.length&&data!=null;i++){if(parts[i]in data)data=data[parts[i]];else data=null}if(typeof data=="string"){if(escape)data=data.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");if(quote)data='"'+data+'"'}return data}if(mode=="fn"){var args=[];args.push(Template.expand(parts[0],data,"arg"));if("_"+args[0]in Template.filters)args[0]="_"+args[0];if(!(args[0]in Template.filters))return`(Unknown: ${args[0]})`;if(args[0][0]=="_")return Template.filters[args[0]](parts,data);for(let i=1;i<parts.length;i++)args.push(Template.expand(parts[i],data,"arg"));return Template.filters[args[0]](args,parts,data)}if(mode=="tpl"){if(parts.length==1)return Template.expand(parts[0],data,"var");return Template.expand(parts,data,"fn")}let s=[];for(let i=0;i<parts.length;i++){if(typeof parts[i]!="string")s.push(Template.expand(parts[i],data,"tpl"));else s.push(parts[i])}if(mode=="arg"){if(s.length!=1)return s.join("");return s[0]}if(mode!="obj"){let f=e=>e!=null&&typeof e=="object"?"map"in e?e.map(f).join(""):"join"in e?e.join(""):e.toString():e;s=s.map(f).join("")}return s},compile:function(template){template=Template.parse(template);return function(data,mode){return Template.expand(template,data,mode)}}};Template.filters={not:function(args){return!args[1]},notnull:function(args){return!!args[1]},int:function(args){return~~args[1]},eq:function(args){return args[1]==args[2]},ne:function(args){return args[1]!=args[2]},lt:function(args){return args[1]<args[2]},le:function(args){return args[1]<=args[2]},gt:function(args){return args[1]>args[2]},ge:function(args){return args[1]>=args[2]},and:function(args){for(let i=1;i<args.length;i++)if(!args[i])return false;return true},or:function(args){for(let i=1;i<args.length;i++)if(~~args[i])return true;return false},json:function(args){return JSON.stringify(args[1],null,4)},set:function(args,parts,data){data[args[1]]=args[2];return""},trim:function(args){return args[1]?typeof args[1]=="object"?args[1].map(e=>e.trim()):args[1].trim():""},upper:function(args){return args[1]?typeof args[1]=="object"?args[1].map(e=>e.toUpperCase()):args[1].toUpperCase():""},lower:function(args){return args[1]?typeof args[1]=="object"?args[1].map(e=>e.toLowerCase()):args[1].toLowerCase():""},nl2br:function(args){return args[1]?typeof args[1]=="object"?args[1].map(e=>e.replace(/\n/g,"<br/>")):args[1].replace(/\n/g,"<br/>"):""},"%":function(args){args.shift();var name=args.shift();let s="";for(let i=0;i<args.length;i++){if(typeof args[i]!="string"){for(let j=0;j<args[i].length;j++)s+=`<${name}>${args[i][j]}</${name}>`}else s+=`<${name}>${args[i]}</${name}>`}return s},"%%":function(args){args.shift();var name=args.shift();let attr="";let text="";for(let i=0;i<args.length;i+=2){if(i+1<args.length)attr+=` ${args[i]}="${args[i+1]}"`;else text=args[i]}return text?`<${name}${attr}>${text}</${name}>`:`<${name}${attr}/>`},join:function(args){if(args[2]&&typeof args[2]=="object"&&"join"in args[2])return args[2].join(args[1]);return""},split:function(args){if(args[2]&&typeof args[2]=="string")return args[2].split(args[1]);return[]},keys:function(args){if(args[1]&&typeof args[1]=="object")return Object.keys(args[1]);return[]},values:function(args){if(args[1]&&typeof args[1]=="object")return Object.values(args[1]);return[]},each:function(args,parts,data){let var_name="i";let list=args[1];let k=2;if(args[k]&&args[k].match(/^[A-Za-z0-9_-]+$/)!=null)var_name=args[k++];let s=[];for(let i in list){data[var_name]=list[i];data[var_name+"#"]=i;for(let j=k;j<parts.length;j++)s.push(Template.expand(parts[j],data,"obj"))}delete data[var_name];delete data[var_name+"#"];return s},"_?":function(parts,data){if(Template.expand(parts[1],data,"arg"))return Template.expand(parts[2],data,"arg");if(parts.length>3)return Template.expand(parts[3],data,"arg");return""},_if:function(parts,data){for(let i=0;i<parts.length;i+=3){if(Template.expand(parts[i],data,"arg")=="else")return Template.expand(parts[i+1],data,"text");if(Template.expand(parts[i+1],data,"arg"))return Template.expand(parts[i+2],data,"text")}return""},_switch:function(parts,data){let value=Template.expand(parts[1],data,"arg");for(let i=2;i<parts.length;i+=2){let case_value=Template.expand(parts[i],data,"arg");if(case_value==value||case_value=="default")return Template.expand(parts[i+1],data,"arg")}return""},repeat:function(args,parts,data){let var_name="i";let count=~~args[1];let k=2;if(args[k]&&args[k].match(/^[A-Za-z0-9_-]+$/)!=null)var_name=args[k++];let s=[];for(let i=0;i<count;i++){data[var_name]=i;for(let j=k;j<parts.length;j++)s.push(Template.expand(parts[j],data,"obj"))}delete data[var_name];return s}}},{}],20:[function(require,module,exports){const xui=require("../xui");xui.register("xui-context",{isRoot:true,events:{"click [data-action]":function(evt){let action=evt.source.dataset.action;evt.source=this._source;this.root[action](evt)}},init:function(){this.classList.add("xui-dropdown");this.classList.add("xui-context")},onConnected:function(){this.root=this.findRoot();this._contextListener=this.root.listen("contextmenu",this.dataset.target,evt=>{evt.continuePropagation=true;this.classList.add("visible");this._source=evt.source;let hdl=evt=>{if(evt.type=="contextmenu"&&evt.source===this._source)return;this.classList.remove("visible");window.removeEventListener("click",hdl);window.removeEventListener("contextmenu",hdl)};window.addEventListener("click",hdl);window.addEventListener("contextmenu",hdl);let parent=xui.position.get(this.root);xui.position.set(this,evt.clientX-parent.x,evt.clientY-parent.y)})},onDisconnected:function(){this._contextListener.remove()},show:function(){if(this.classList.contains("visible"))return;this.classList.remove("hidden");this.classList.add("visible")},hide:function(){if(this.classList.contains("hidden"))return;this.classList.remove("visible");this.classList.add("hidden")}})},{"../xui":25}],21:[function(require,module,exports){const xui=require("../xui");xui.register("xui-dialog","xui-element",{init:function(){this.classList.add("xui-dialog");if(this.classList.contains("x-draggable"))xui.draggable.attach(this.querySelector(".header"),this)},show:function(){if(this.classList.contains("visible"))return;this.classList.remove("hidden");this.classList.add("visible")},hide:function(){if(this.classList.contains("hidden"))return;this.classList.remove("visible");this.classList.add("hidden")},maximize:function(){this.classList.add("maximized")},restore:function(){this.classList.remove("maximized")}})},{"../xui":25}],22:[function(require,module,exports){const xui=require("../xui");xui.register("xui-element",{isRoot:true,events:{"click [data-action]":function(evt){this[evt.source.dataset.action](evt)},"keyup(13) input[data-enter]":function(evt){this[evt.source.dataset.enter](evt)}},init:function(){}})},{"../xui":25}],23:[function(require,module,exports){const xui=require("../xui");xui.register("xui-list",{events:{"click span[data-value]":function(evt){this.setValue(evt.source.dataset.value)}},init:function(){this.classList.add("xui-list");this.type="field";if(this.dataset.rows){this.style.height="0px";this.style.height=this.dataset.rows*this.getHeight(this.children[0])+this.getHeight()+"px"}if(this.classList.contains("x-scrollable"))xui.scrollable.attach(this)},setValue:function(value){let selected=this.querySelector('span[data-value="'+value+'"]');if(!selected)return;let curr=this.querySelector("span.selected");if(curr){if(curr.dataset.value==value)return;curr.classList.remove("selected")}selected.classList.add("selected");if(this.onchange)this.onchange()},getValue:function(){let selected=this.querySelector("span.selected");return selected?selected.dataset.value:null}})},{"../xui":25}],24:[function(require,module,exports){require("./elems/xui-element.js");require("./elems/xui-dialog.js");require("./elems/xui-list.js");require("./elems/xui-context.js");module.exports=require("./xui")},{"./elems/xui-context.js":20,"./elems/xui-dialog.js":21,"./elems/xui-element.js":22,"./elems/xui-list.js":23,"./xui":25}],25:[function(require,module,exports){const{Element:Element}=require("@rsthn/rin-front");const{Template:Template}=require("@rsthn/rin");const xui=module.exports={elements:[],template:function(str){return Template.compile(str)},register:function(name,...protos){this.elements.push(name);Element.register(name,...protos)},alignValue:function(value,step){return Math.round(value/step)*step},position:{get:function(elem){let p=elem.getBoundingClientRect();return{x:p.left,y:p.top}},set:function(elem,...args){if(args.length==1)return this.set(elem,args[0].x,args[0].y);elem.style.position="absolute";elem.style.margin=0;elem.style.left=args[0]+"px";elem.style.top=args[1]+"px"}},draggable:{initialized:false,state:{enabled:false,sx:0,sy:0,pos:null,target:null},attach:function(handle,target,options){if(!handle||!target)return;if(!this.initialized){window.onmousemove=this._handler.bind(this);this.initialized=true}handle.onmousedown=(evt=>{this.state.sx=evt.clientX;this.state.sy=evt.clientY;this.state.pos=xui.position.get(this.state.target=target);this.state.enabled=true});handle.onmouseup=(evt=>{this.state.enabled=false})},_handler:function(evt){if(!this.state.enabled)return;let dx=evt.clientX-this.state.sx;let dy=evt.clientY-this.state.sy;xui.position.set(this.state.target,this.state.pos.x+dx,this.state.pos.y+dy)}},scrollable:{initialized:false,attach:function(target){let mutex=false;let bar=document.createElement("em");bar.classList.add("vs-bar");bar.classList.add("pseudo");let innerBar=document.createElement("em");bar.appendChild(innerBar);let innerMostBar=document.createElement("em");innerBar.appendChild(innerMostBar);target.appendChild(bar);let update=function(){let height=target.getBoundingClientRect().height;innerMostBar.style.height=(100*height/target.scrollHeight).toFixed(2)+"%";bar.style.top=target.scrollTop+"px";innerMostBar.style.top=(100*target.scrollTop/target.scrollHeight).toFixed(2)+"%"};target._observer_scroll=new MutationObserver(function(){if(mutex)return;mutex=true;if(bar.parentNode!=target){bar.style.top="0px";innerMostBar.style.height="0px";target.appendChild(bar)}update();mutex=false});target._observer_scroll.observe(target,{childList:true});update();target.onwheel=function(evt){target.scrollTop+=15*evt.deltaY;bar.style.top=target.scrollTop+"px";innerMostBar.style.top=(100*target.scrollTop/target.scrollHeight).toFixed(2)+"%"}}},showDownload:function(filename,dataUrl){var link=document.createElement("a");link.href=dataUrl;link.style.display="none";link.download=filename;link.target="_blank";document.body.appendChild(link);link.click();document.body.removeChild(link)},showFilePicker:function(allowMultiple,callback){var input=document.createElement("input");input.type="file";input.style.display="none";input.multiple=allowMultiple;document.body.appendChild(input);input.onchange=function(){if(input._timer)clearTimeout(input._timer);document.body.onfocus=null;document.body.removeChild(input);callback(input.files)};document.body.onfocus=function(){document.body.onfocus=null;input._timer=setTimeout(function(){document.body.removeChild(input);callback(null)},0)};input.click()},loadAsDataURL:function(file,callback){var reader=new FileReader;reader.onload=function(e){callback(e.target.result)};reader.readAsDataURL(file)},loadAsText:function(file,callback){var reader=new FileReader;reader.onload=function(e){callback(e.target.result)};reader.readAsText(file)},loadAsArrayBuffer:function(file,callback){var reader=new FileReader;reader.onload=function(e){callback(e.target.result)};reader.readAsArrayBuffer(file)},loadAllAsDataURL:function(fileList,callback){var result=[];if(!fileList||!fileList.length){callback(result);return}var loadNext=function(i){if(i==fileList.length){callback(result);return}xui.loadAsDataURL(fileList[i],function(url){result.push({name:fileList[i].name,size:fileList[i].size,url:url});loadNext(i+1)})};loadNext(0)}}},{"@rsthn/rin":13,"@rsthn/rin-front":3}]},{},[24]);
